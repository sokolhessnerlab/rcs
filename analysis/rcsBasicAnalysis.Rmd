---
title: "RCS Basic Analysis"
author: "Hayley Brooks"
date: "2022-10-12"
output: html_document
---

# To do:
# how does complex span and ERQ in our dataset compare to others?
# check rfx for context effects, start with past outcome
# should we account for outcome on randomly selected trial from round 1? could put in outcome variable mean centered -30 to 30



```{r setup, include=FALSE}
rm(list=ls())

library('config')
config = config::get()

library('lmerTest')

setup_source = file.path(config$path$code_files$dataSetUp) # run our set up script (which loads all the data)
source(setup_source) #, local = knitr::knit_global())
```

#### How many participants are in each condition/order?
```{r conditions, echo=FALSE}

cat("participants in natural-natural condition:",sum(rcsSubLevelWide_clean$condCode==1), "\nparticipants in natural-strategy condition:",sum(rcsSubLevelWide_clean$condCode==2), "\nparticipants in strategy-natural condition:",sum(rcsSubLevelWide_clean$condCode==3),"\nparticipants in strategy-strategy condition:", sum(rcsSubLevelWide_clean$condCode==4))


condcode1 = rcsSubLevelWide_clean$subID[rcsSubLevelWide_clean$condCode==1]
condcode2 = rcsSubLevelWide_clean$subID[rcsSubLevelWide_clean$condCode==2]
condcode3 = rcsSubLevelWide_clean$subID[rcsSubLevelWide_clean$condCode==3]
condcode4 = rcsSubLevelWide_clean$subID[rcsSubLevelWide_clean$condCode==4]
```

#### Demographic
```{r demographic-info}

# Race code: 1 = white, 2 = Black or African American, 3 = American Indian and Alaskan Native, 4 = Asian, 5 = Native Hawaiian and Other Pacific Islander, 6 = Two or more races, 7= other, 8 = Decline to answer
cat("RACE: \nWhite:", sum(rcsSubLevelWide_clean$raceCode==1), 
        "\nBlack or African American:",sum(rcsSubLevelWide_clean$raceCode==2), 
        "\nAmerican Indian and Alaskan Native:",sum(rcsSubLevelWide_clean$raceCode==3),
        "\nAsian:", sum(rcsSubLevelWide_clean$raceCode==4),
        "\nNative Hawaiian and Other Pacific Islander:", sum(rcsSubLevelWide_clean$raceCode==5),
        "\nTwo or more races:", sum(rcsSubLevelWide_clean$raceCode==6),
        "\nOther:", sum(rcsSubLevelWide_clean$raceCode==7),
        "\nDecline to answer:", sum(rcsSubLevelWide_clean$raceCode==8))


# Ethnicity code: 1 = Hispanic or Latino; 2 = Not Hispanic or Latino
cat("ETHNICITY: \nHispanic or Latino:", sum(rcsSubLevelWide_clean$ethnicityCode==1), 
        "\nNon-Hispanic or Latino:",sum(rcsSubLevelWide_clean$ethnicityCode==2))

# Gender code: 1 = Male, 2 = Female, 3 = Trans Male, 4 = Trans Female, 5 = Gender nonconforming, 6 = other, 7 = Decline to answer
cat("GENDER: \nMale:", sum(rcsSubLevelWide_clean$genderCode==1), 
        "\nFemale:",sum(rcsSubLevelWide_clean$genderCode==2), 
        "\nTrans Male:",sum(rcsSubLevelWide_clean$genderCode==3),
        "\nTrans Female:", sum(rcsSubLevelWide_clean$genderCode==4),
        "\nGender nonconforming:", sum(rcsSubLevelWide_clean$genderCode==5),
        "\nOther:", sum(rcsSubLevelWide_clean$genderCode==6),
        "\nDecline to answer:", sum(rcsSubLevelWide_clean$genderCode==7))


# Age:
cat("AGE (years): \nmean =", mean(rcsSubLevelWide_clean$age),
    "\nrange =", range(rcsSubLevelWide_clean$age),
    "\nmedian =", median(rcsSubLevelWide_clean$age))

```


#### Average change in risk-taking across conditions
```{r, risk-taking-across-rounds, echo=FALSE}

# What is the overall p(gamble) in each round (not separating by condition)
# some basic pgamble stuff
summary(rcsSubLevelWide_clean$round1_pgamble)
# range: 0.007692-0.885496; median: 0.538168 mean: 0.533754

summary(rcsSubLevelWide_clean$round2_pgamble)
# range: 0.0229-0.9160  median: 0.5249  mean: 0.5343  

t.test(rcsSubLevelWide_clean$round1_pgamble, rcsSubLevelWide_clean$round2_pgamble, paired = T); # no significant difference in mean pgamble across rounds

# differences in pgam from round 1 to round 2:
pgamDiff = rcsSubLevelWide_clean$round1_pgamble - rcsSubLevelWide_clean$round2_pgamble

# Risk-taking slightly decreased from round 1 to round 2, but the difference is not significant.

# What does the change in risk-taking from round 1 to round 2 look like for the different conditions?

# CONTROL- CONTROL
pgamDiffnatNat=mean(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$subID %in% as.numeric(condcode1)] - rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$subID %in% as.numeric(condcode1)]);
cat("\n\nDifference in risk-taking across rounds \nnatural(round1) - natural (round2)\ndiff p(gamble)",pgamDiffnatNat);

# Risk-taking decreases from round 1 to round 2 in people are told to act natural in both rounds.


# CONTROL- STRATEGY
pgamDiffnatStrat = mean(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$subID %in% as.numeric(condcode2)] - rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$subID %in% as.numeric(condcode2)]);
cat("\n\nDifference in risk-taking across rounds \nnatural(round1) - strategy (round2)\ndiff p(gamble)",pgamDiffnatStrat);

# Risk-taking increases from round 1 to round 2 when people go from act natural to strategy condition.


# STRATEGY-CONTROL
pgamDiffstratNat = mean(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$subID %in% as.numeric(condcode3)] - rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$subID %in% as.numeric(condcode3)]);
cat("\n\nDifference in risk-taking across rounds \nstrategy(round1) - natural (round2)\ndiff p(gamble)",pgamDiffstratNat);

# Risk-taking decreases from round 1 to round 2 when people go from strategy to natural.


# STRATEGY-STRATEGY
pgamDiffstratStrat = mean(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$subID %in% as.numeric(condcode4)] - rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$subID %in% as.numeric(condcode4)]);
cat("\n\nDifference in risk-taking across rounds \nstrategy(round1) - strategy (round2)\ndiff p(gamble)",pgamDiffstratStrat);

# Risk-taking increases from round 1 to round 2 when people do strategy in both rounds. 

# SUMMARY: Generally, more risk-taking in the strategy condition when people do both natural and strategy (regardless of order). When people repeat act natural, they take less risks across time and when people repeat strategy, they take more risks over time.


pdf(file.path(config$path$directory, config$path$shlab_figures,'pgamByRound_condition.pdf'))
par(pty="s", mfrow=c(2,2))

plot(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$condCode==1], rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$condCode==1], asp=1,col = "blue", pch=16, ylim=c(0,1), xlim=c(0,1), ylab="p(gamble round 1)", xlab="p(gamble round 2)", axes=F, cex=1.5, main=sprintf("Natural-Natural\npgam diff = %.2f",pgamDiffnatNat))
abline(a = 0, b=1, lty="dashed", col="darkgrey",lwd=5)
axis(1, lwd=6)
axis(2, lwd=6)


plot(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$condCode==2], rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$condCode==2], asp=1,col = "green", pch=16, ylim=c(0,1), xlim=c(0,1), ylab="p(gamble round 1)", xlab="p(gamble round 2)", axes=F, cex=1.5, main=sprintf("Natural-Strategy\npgam diff = %.2f",pgamDiffnatStrat))
abline(a = 0, b=1, lty="dashed", col="darkgrey",lwd=5)
axis(1, lwd=6)
axis(2, lwd=6)

plot(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$condCode==3], rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$condCode==3],col = "red", pch=16, ylim=c(0,1), xlim=c(0,1), ylab="p(gamble round 1)", xlab="p(gamble round 2)", asp =1, axes=F, cex=1.5, main=sprintf("Strategy-Natural\npgam diff = %.2f",pgamDiffstratNat))
abline(a = 0, b=1, lty="dashed", col="darkgrey",lwd=5)
axis(1, lwd=6)
axis(2, lwd=6)

plot(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$condCode==4], rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$condCode==4], asp=1,col = "purple", pch=16, ylim=c(0,1), xlim=c(0,1), ylab="p(gamble round 1)", xlab="p(gamble round 2)", axes=F, cex=1.5, main=sprintf("Strategy-Strategy\npgam diff = %.2f",pgamDiffstratStrat))
abline(a = 0, b=1, lty="dashed", col="darkgrey",lwd=5)
axis(1, lwd=6)
axis(2, lwd=6)
dev.off();
```

Another version of plots above: Not super helpful plots with full dataset
```{r plot-basic-pgamacrossall, echo=FALSE}


par(pty="s")
plot(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$condCode==1], rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$condCode==1], asp=1,col = rgb(red=0, green=0, blue=1, alpha = 0.4), pch=16, ylim=c(0,1), xlim=c(0,1), ylab="p(gamble round 1)", xlab="p(gamble round 2)", axes=F, cex=2)

abline(a = 0, b=1, lty="dashed", col="darkgrey",lwd=5)

points(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$condCode==2], rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$condCode==2], col = rgb(red=0, green=1, blue=0, alpha = 0.4),asp=1, pch=16,cex=2)

points(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$condCode==3], rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$condCode==3], asp=1, col = rgb(red=1, green=0, blue=0, alpha = 0.4), pch=16, cex=2)


points(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$condCode==4], rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$condCode==4], asp= 1,col = rgb(red=.5, green=0, blue=.5, alpha = 0.4), pch=16, cex=2)
axis(1, lwd=6)
axis(2, lwd=6)
legend("bottomright", legend=c("nat-nat","nat-strat", "strat-nat" ,"strat-strat"), pch=16, bty="n", col=c("blue", "green", "red", "purple"), cex=1)



plot(c(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$condCode==2]- rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$condCode==2], rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$condCode==3]- rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$condCode==3]), pch=16, ylab="Risk-taking\n (round 1 - round 2)", xlab="participant", ylim=c(-.5,.5),cex= 2,col=c(rep("green",length(condcode2)), rep("red", length(condcode3))), axes=F)
axis(1, at =1:sum(rcsSubLevelWide_clean$condCode %in% c(2,3)), labels = as.numeric(c(rcsSubLevelWide_clean$subID[rcsSubLevelWide_clean$condCode==2], rcsSubLevelWide_clean$subID[rcsSubLevelWide_clean$condCode==3])), lwd=6, cex.axis=1)
axis(2, lwd=6, cex=1.5)
abline(h=0, col="darkgrey", lty="dashed", lwd=4)

legend("bottomright", legend=c("nat-strat", "strat-nat"), pch=16, bty="n", col=c("green","red"), cex=1)

```


#### Post round difficulty ratings
```{r instDifficulty-ratings}
# Participants rated how difficult the instructions were to follow on a scale from 1-100

# ACROSS CONDITIONS
summary(rcsSubLevelLong_clean$instDifficult[rcsSubLevelLong_clean$strategy==0]); 
   # Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   # 1.00   12.89   25.83   30.95   49.80   79.59 
summary(rcsSubLevelLong_clean$instDifficult[rcsSubLevelLong_clean$strategy==1]);
   # Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   # 1.00   11.62   27.49   34.18   56.98   99.80 
# Participants rated strategy instructions as more difficult, on average, relative to control. This does not account for condition/order


# NATURAL-NATURAL
natNatRound1difficulty = rcsSubLevelWide_clean$round1_instDifficult[rcsSubLevelWide_clean$condCode==1];
natNatRound2difficulty = rcsSubLevelWide_clean$round2_instDifficult[rcsSubLevelWide_clean$condCode==1];
cond1difficultydiff = mean(natNatRound1difficulty - natNatRound2difficulty);

# round 1, natural-natural
summary(natNatRound1difficulty);
   # Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   # 1.00   12.79   22.75   27.48   38.13   64.36 

# round 2, natural-natural
summary(natNatRound2difficulty)
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.758  18.457  39.746  36.489  56.494  79.590 

t.test(natNatRound1difficulty, natNatRound2difficulty, paired=T); # significant difference, p = .02

# Difficulty ratings significantly higher in round 2 for people repeating natural.


# NATURAL-STRATEGY
natStratRound1difficulty = rcsSubLevelWide_clean$round1_instDifficult[rcsSubLevelWide_clean$condCode==2];
natStratRound2difficulty = rcsSubLevelWide_clean$round2_instDifficult[rcsSubLevelWide_clean$condCode==2];
cond2difficultydiff = mean(natStratRound1difficulty - natStratRound2difficulty);


summary(natStratRound1difficulty);
   # Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   # 1.00   11.23   29.20   31.55   50.88   77.64 

summary(natStratRound2difficulty);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 2.637  16.699  33.691  41.777  66.602  92.578

t.test(natStratRound1difficulty, natStratRound2difficulty, paired=T); # trending difference, p = .09

# Difficulty higher in round 2 for people who start with natural and do strategy.


# STRATEGY-NATURAL
stratNatRound1difficulty = rcsSubLevelWide_clean$round1_instDifficult[rcsSubLevelWide_clean$condCode==3];
stratNatRound2difficulty = rcsSubLevelWide_clean$round2_instDifficult[rcsSubLevelWide_clean$condCode==3];
cond3difficultydiff = mean(stratNatRound1difficulty - stratNatRound2difficulty);


summary(stratNatRound1difficulty);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.074   8.398  24.707  31.096  51.465  99.805 

summary(stratNatRound2difficulty);
   # Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   # 1.00   13.53   24.22   28.30   37.11   76.17 

t.test(stratNatRound1difficulty, stratNatRound2difficulty, paired=T); # n.s, p = .64

# Difficulty ratings are slightly lower for natural after strategy The difference is not significant and much smaller than people who go from natural to strategy


# STRATEGY-STRATEGY
stratStratRound1difficulty = rcsSubLevelWide_clean$round1_instDifficult[rcsSubLevelWide_clean$condCode==4];
stratStratRound2difficulty = rcsSubLevelWide_clean$round2_instDifficult[rcsSubLevelWide_clean$condCode==4];
cond4difficultydiff = mean(stratStratRound1difficulty - stratStratRound2difficulty)
  
summary(stratStratRound1difficulty);
   # Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   # 1.00   13.23   30.76   33.84   57.37   87.11 

summary(stratStratRound2difficulty);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 2.930   9.521  23.828  30.015  41.602  86.816 

t.test(stratStratRound1difficulty, stratStratRound2difficulty, paired=T); # n.s, p = .35

# Difficulty ratings are slightly lower in round 2 for people who do strat-strat but the difference is not significant. This is not consistent with people who repeat nat-nat who found second round as more difficult.

# These ratings are odd, there isn't a clear pattern here. What about looking at strat vs nat in round 2 for people who experienced natural first and for people who experience strategy first
plot(c(1,2), c(mean(natNatRound1difficulty), mean(natNatRound2difficulty)), pch = 16, col="red", ylim=c(20,50), ylab="difficulty ratings", xlab="condition\nred = nat-nat\n blue=nat-strat", main="Difficulty ratings as fx of round 1 natural", axes=F);
points(c(1,2), c(mean(natStratRound1difficulty), mean(natStratRound2difficulty)), pch = 16, col="blue");
axis(1, at=c(1,2), label=c("round 1", "round 2"))
axis(2, at=c(20,30,40,50))

plot(c(1,2), c(mean(stratNatRound1difficulty), mean(stratNatRound2difficulty)), pch = 16, col="red", ylim=c(20,50), ylab="difficulty ratings", xlab="condition\nred = strat-nat\n blue=strat-strat", main="Difficulty ratings as fx of round 1 strategy", axes=F);
points(c(1,2), c(mean(stratStratRound1difficulty), mean(stratStratRound2difficulty)), pch = 16, col="blue");
axis(1, at=c(1,2), label=c("round 1", "round 2"))
axis(2, at=c(20,30,40,50))

# These plots suggest that if you start with natural, anything after that including natural is more difficult. If you start with strategy, anything after that is less difficult (inc. repeating strategy condition)

# Overall, these results suggests that we need to be careful about how we use the difficulty ratings because they are super variable and aren't as straightforward as we expected It is possible that mean is not the best measure. 
# it might worth looking at change in ratings instead of actual ratings


# What about comparing natural vs. strategy in round 1 only (N=62 per group)

natFirst = rcsSubLevelWide_clean$round1_instDifficult[rcsSubLevelWide_clean$condCode %in% c(1,2)]; # people who do nat first

summary(natFirst);
   # Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   # 1.00   11.23   23.58   29.51   49.61   77.64 

stratFirst = rcsSubLevelWide_clean$round1_instDifficult[rcsSubLevelWide_clean$condCode %in% c(3,4)]; # people who do strat first

summary(stratFirst);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.000   9.912  26.709  32.468  55.688  99.805 

t.test(natFirst, stratFirst); # ns, p= .5

# No significant difference between difficulty ratings in natural and strategy for people who do natural and strategy first.


# Plot round 1 vs round 2 difficulty ratings for each condition:
pdf(file.path(config$path$directory, config$path$shlab_figures,'InstDifficultyRatingPlots.pdf'))
par(pty="s", mfrow= c(2,2))
plot(natNatRound1difficulty, natNatRound2difficulty, ylim=c(0,100), xlim=c(0,100), ylab="Act natural Round 2", xlab="Act natural Round 1", pch=16, cex = 1.5, col="blue", main=sprintf("Natural-Natural\ndifficulty diff = %.2f",cond1difficultydiff))
abline(a=0, b=1, col="grey")

plot(natStratRound1difficulty, natStratRound2difficulty, ylim=c(0,100), xlim=c(0,100), ylab="Strategy Round 2", xlab="Act natural Round 1", pch=16, cex = 1.5, col="green",main=sprintf("Natural-Strategy\ndifficulty diff = %.2f",cond2difficultydiff))
abline(a=0, b=1, col="grey")

plot(stratNatRound1difficulty, stratNatRound2difficulty, ylim=c(0,100), xlim=c(0,100), ylab="Act Natural Round 2", xlab="Strategy Round 1", pch=16, cex = 1.5, col="red", main=sprintf("Strategy-Natural\ndifficulty diff = %.2f",cond3difficultydiff))
abline(a=0, b=1, col="grey") 

plot(stratStratRound1difficulty, stratStratRound2difficulty, ylim=c(0,100), xlim=c(0,100), ylab="Strategy Round 2", xlab="Strategy Round 1", pch=16, cex = 1.5, col="purple", main=sprintf("Strategy-Strategy\ndifficulty diff = %.2f",cond4difficultydiff))
abline(a=0, b=1, col="grey")

mtext("Instruction Difficulty Ratings", side = 3, line = - 2, outer = TRUE)
dev.off()

```


#### Post round how often/frequency ratings
```{r instFrequency-ratings}
# Participants reported how often they were able to follow instructions in each round of the rdm task

# FREQUENCY RATINGS FOR INSTRUCTION TYPE OVERALL (not accounting for order/condition)
summary(rcsSubLevelLong_clean$instHowOften[rcsSubLevelLong_clean$strategy==0]);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 18.36   63.40   75.39   75.17   91.46   99.90 
summary(rcsSubLevelLong_clean$instHowOften[rcsSubLevelLong_clean$strategy==1]);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 22.17   63.45   79.30   75.06   90.72   99.90 

# Participants were able to follow instructions about the same across instructions 

#FREQUENCY RATINGS FOR INSTRUCTIONS ACROSS ROUNDS 
summary(rcsSubLevelWide_clean$round1_instHowOften);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 18.36   67.31   79.98   76.66   91.46   99.71 

summary(rcsSubLevelWide_clean$round2_instHowOften);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 22.17   60.50   75.20   73.57   90.87   99.90 

# participants reported following instructions less in round 2 but difference is small


# NATURAL-NATURAL
natNatRound1howOften = rcsSubLevelWide_clean$round1_instHowOften[rcsSubLevelWide_clean$condCode==1];
natNatRound2howOften = rcsSubLevelWide_clean$round2_instHowOften[rcsSubLevelWide_clean$condCode==1];
cond1freqdiff = mean(natNatRound1howOften-natNatRound2howOften);

summary(natNatRound1howOften);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 18.36   66.70   76.66   73.10   90.09   98.73 

summary(natNatRound2howOften);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 38.18   58.40   70.90   72.31   90.38   97.66 

t.test(natNatRound1howOften,natNatRound2howOften, paired= T); #not significant p =.8

# Participants followed instructions about the same amount of time in both natural rounds.


# NATURAL-STRATEGY
natStratRound1howOften = rcsSubLevelWide_clean$round1_instHowOften[rcsSubLevelWide_clean$condCode==2];
natStratRound2howOften = rcsSubLevelWide_clean$round2_instHowOften[rcsSubLevelWide_clean$condCode==2];
cond2freqdiff = mean(natStratRound1howOften-natStratRound2howOften);

summary(natStratRound1howOften);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 48.44   65.14   75.49   76.87   90.82   99.71 
summary(natStratRound2howOften);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 22.17   57.03   72.75   69.22   84.81   99.90 

t.test(natStratRound1howOften,natStratRound2howOften, paired= T); #significant difference p =.04

# Participants reporting following instructions less in strategy condition relative to first round of natural.

# STRATEGY-NATURAL
stratNatRound1howOften = rcsSubLevelWide_clean$round1_instHowOften[rcsSubLevelWide_clean$condCode==3];
stratNatRound2howOften = rcsSubLevelWide_clean$round2_instHowOften[rcsSubLevelWide_clean$condCode==3];
cond3freqdiff = mean(stratNatRound1howOften-stratNatRound2howOften);


summary(stratNatRound1howOften);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 31.05   67.92   80.66   76.97   90.87   99.12

summary(stratNatRound2howOften);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 38.77   64.31   81.54   78.40   97.61   99.90 

t.test(stratNatRound1howOften,stratNatRound2howOften, paired= T); #no significant difference

# Participants reported no significant change in difficulty when going from strategy to natural (although mean difference is in expected direction with frequency higher in natural)


# STRATEGY-STRATEGY
stratStratRound1howOften = rcsSubLevelWide_clean$round1_instHowOften[rcsSubLevelWide_clean$condCode==4];
stratStratRound2howOften = rcsSubLevelWide_clean$round2_instHowOften[rcsSubLevelWide_clean$condCode==4];
cond4freqdiff = mean(stratStratRound1howOften-stratStratRound2howOften);

summary(stratStratRound1howOften);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 35.84   72.61   80.96   79.69   95.90   98.54 

summary(stratStratRound2howOften);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 25.78   60.35   79.79   74.36   94.14   99.02 

t.test(stratStratRound1howOften,stratStratRound2howOften, paired= T); #not significant difference

# Participants reported following instructions less often in second round when repeating strategy but difference is not significant.

# Overall, participants reported following instructions between 70-80% of the time. When participants repeat conditions, frequency ratings are similar. When participants switch conditions, frequency ratings are higher for natural relative to strategy condition but this difference is only significant when going from natural to strategy.


# What about comparing strat vs nat in round 1 only:

natFirstFreq = rcsSubLevelWide_clean$round1_instHowOften[rcsSubLevelWide_clean$condCode %in% c(1,2)]; # people who do nat first

summary(natFirstFreq);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 18.36   64.84   76.07   74.99   91.02   99.71 

stratFirstFreq = rcsSubLevelWide_clean$round1_instHowOften[rcsSubLevelWide_clean$condCode %in% c(3,4)]; # people who do strat first

summary(stratFirstFreq);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 31.05   68.48   80.81   78.33   93.46   99.12 

t.test(natFirstFreq, stratFirstFreq); # ns, p= .32

# No significant difference between natural and strategy frequency ratings for people who do natural and strategy first.



pdf(file.path(config$path$directory, config$path$shlab_figures,'InstFrequencyRatingPlots.pdf'))
par(pty="s", mfrow= c(2,2))
plot(natNatRound1howOften, natNatRound2howOften, ylim=c(0,100), xlim=c(0,100), ylab="Act natural Round 2", xlab="Act natural Round 1", pch=16, cex = 1.5, col="blue", main=sprintf("Natural-Natural\nfrequency diff = %.2f",cond1freqdiff))
abline(a=0, b=1, col="grey")

plot(natStratRound1howOften, natStratRound2howOften, ylim=c(0,100), xlim=c(0,100), ylab="Strategy Round 2", xlab="Act natural Round 1", pch=16, cex = 1.5, col="green", main=sprintf("Natural-Strategy\nfrequency diff = %.2f",cond2freqdiff))
abline(a=0, b=1, col="grey")

plot(stratNatRound1howOften, stratNatRound2howOften, ylim=c(0,100), xlim=c(0,100), ylab="Act Natural Round 2", xlab="Strategy Round 1", pch=16, cex = 1.5, col="red", main=sprintf("Strategy-Natural\nfrequency diff = %.2f",cond3freqdiff))
abline(a=0, b=1, col="grey")

plot(stratStratRound1howOften, stratStratRound2howOften, ylim=c(0,100), xlim=c(0,100), ylab="Strategy Round 2", xlab="Strategy Round 1", pch=16, cex = 1.5, col="purple",  main=sprintf("Strategy-Strategy\nfrequency diff = %.2f",cond4freqdiff))
abline(a=0, b=1, col="grey")

mtext("Instruction Frequency Ratings", side = 3, line = - 2, outer = TRUE)
dev.off()

```

#### Reaction time
```{r RT-mean-of-means}
# using mean reaction time with two versions - all trials vs remove fast trials

# RTmean = mean with all trials
# RTmeanClean = mean removing fast trials (<1s) 
# There were 7600 trials across both rounds with RTs less than 1s and all 124 participants had trials with fast RTs ranging from 1 trial to 176 trials across both rounds
# There were more fast trials in round 2 relative to round 1 but the range of number of missed trials per participant in round 2 was smaller.

# fastTrialIndround1 = which(rdmDFclean$RT<1 & rdmDFclean$roundRDM==1); # fast trials in round 1
# fastTrialIndround2 = which(rdmDFclean$RT<1 & rdmDFclean$roundRDM==2); # fast trials in round 2
# 
# subIDsFastTrialsround1 = rdmDFclean$subIDnum[fastTrialIndround1]; # subid of fast trials in round 1
# subIDsFastTrialsround2 = rdmDFclean$subIDnum[fastTrialIndround2]; # subid of fast trials in round 2
# 
# length(unique(subIDsFastTrialsround1)); # 3291 fast trials in round 1 and all participants have at least one fast trial
# length(unique(subIDsFastTrialsround2)); #4309 fast trials in round 2 and 121/124 participants have at least one fast trial
# fastTriPerSubround1 = vector();
# fastTriPerSubround2 = vector();
# 
# How many trials per participant were fast?:
# for (s in 1:nSub) {
#   fastTriPerSubround1[s]= sum(subIDsFastTrialsround1==as.numeric(subIDchar[s]))
#   fastTriPerSubround2[s]= sum(subIDsFastTrialsround2==as.numeric(subIDchar[s]))
# };

#summary(fastTriPerSubround1);
   # Min. 1st Qu.  Median    Mean  3rd Qu.    Max. 
   # 1.00    7.00   20.50   26.54   40.00  101.00 

#summary(fastTriPerSubround2);
   # Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   # 0.00   14.00   28.50   34.75   54.00   84.00 




# ACROSS INSTRUCTION TYPE
# all trials
summary(rcsSubLevelLong_clean$RTmean[rcsSubLevelLong_clean$strategy==0]);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.9459  1.1345  1.3046  1.3399  1.4845  2.3205 
summary(rcsSubLevelLong_clean$RTmean[rcsSubLevelLong_clean$strategy==1]);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.8911  1.1834  1.3807  1.3889  1.5570  2.2312 

# remove fast trials
summary(rcsSubLevelLong_clean$RTmeanClean[rcsSubLevelLong_clean$strategy==0]);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.157   1.312   1.425   1.465   1.592   2.331 
summary(rcsSubLevelLong_clean$RTmeanClean[rcsSubLevelLong_clean$strategy==1]);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.150   1.345   1.464   1.498   1.608   2.231 

t.test(rcsSubLevelLong_clean$RTmean[rcsSubLevelLong_clean$strategy==0],rcsSubLevelLong_clean$RTmean[rcsSubLevelLong_clean$strategy==1]); #ns
t.test(rcsSubLevelLong_clean$RTmeanClean[rcsSubLevelLong_clean$strategy==0],rcsSubLevelLong_clean$RTmeanClean[rcsSubLevelLong_clean$strategy==1]); #ns

# Reaction times are not significantly different from each other across instruction type



# ACROSS ROUNDS
# all trials
summary(rcsSubLevelWide_clean$round1_RTmean);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.8911  1.2170  1.4111  1.4171  1.6038  2.3205 

summary(rcsSubLevelWide_clean$round2_RTmean);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.9488  1.1198  1.3155  1.3118  1.4146  2.2312 

# remove fast trials
summary(rcsSubLevelWide_clean$round1_RTmeanClean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.167   1.374   1.485   1.524   1.662   2.331 

summary(rcsSubLevelWide_clean$round2_RTmeanClean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.150   1.289   1.406   1.440   1.526   2.231 

t.test(rcsSubLevelWide_clean$round1_RTmean, rcsSubLevelWide_clean$round2_RTmean)
t.test(rcsSubLevelWide_clean$round1_RTmeanClean, rcsSubLevelWide_clean$round2_RTmeanClean)

# Reaction times significantly faster in round 2


# NATURAL-NATURAL
# All trials
natNatRound1rtmean = rcsSubLevelWide_clean$round1_RTmean[rcsSubLevelWide_clean$condCode==1];
natNatRound2rtmean = rcsSubLevelWide_clean$round2_RTmean[rcsSubLevelWide_clean$condCode==1];
cond1rtdiffmean = mean(natNatRound1rtmean- natNatRound2rtmean);

summary(natNatRound1rtmean);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.9459  1.1830  1.2996  1.3499  1.5016  1.9204 

summary(natNatRound2rtmean);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.9861  1.0695  1.1347  1.2174  1.3385  1.7769 

t.test(natNatRound1rtmean,natNatRound2rtmean, paired=T); # significant difference, p = .0001

# remove fast trials
natNatRound1rtmeanclean = rcsSubLevelWide_clean$round1_RTmeanClean[rcsSubLevelWide_clean$condCode==1];
natNatRound2rtmeanclean = rcsSubLevelWide_clean$round2_RTmeanClean[rcsSubLevelWide_clean$condCode==1];
cond1rtdiffmeanclean = mean(natNatRound1rtmeanclean- natNatRound2rtmeanclean);

summary(natNatRound1rtmeanclean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.186   1.330   1.436   1.472   1.551   1.936

summary(natNatRound2rtmeanclean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.195   1.262   1.321   1.363   1.424   1.803 

t.test(natNatRound1rtmeanclean,natNatRound2rtmeanclean, paired=T); # significant difference, p = 5.936 x10-5

# Participants are significantly faster in round 2 when doing natural both rounds.


# NATURAL-STRATEGY
# all trials
natStratRound1rtmean = rcsSubLevelWide_clean$round1_RTmean[rcsSubLevelWide_clean$condCode==2];
natStratRound2rtmean = rcsSubLevelWide_clean$round2_RTmean[rcsSubLevelWide_clean$condCode==2];
cond2rtdiffmean = mean(natStratRound1rtmean- natStratRound2rtmean);

summary(natStratRound1rtmean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.008   1.235   1.418   1.471   1.625   2.320 
summary(natStratRound2rtmean);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.9968  1.1516  1.3546  1.3779  1.4246  2.2312 

t.test(natStratRound1rtmean,natStratRound2rtmean, paired=T); # significant difference, p = .009

# remove fast trials
natStratRound1rtmeanclean = rcsSubLevelWide_clean$round1_RTmeanClean[rcsSubLevelWide_clean$condCode==2];
natStratRound2rtmeanclean = rcsSubLevelWide_clean$round2_RTmeanClean[rcsSubLevelWide_clean$condCode==2];
cond2rtdiffmeanclean = mean(natStratRound1rtmeanclean- natStratRound2rtmeanclean);

summary(natStratRound1rtmeanclean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.227   1.399   1.494   1.570   1.674   2.331 
summary(natStratRound2rtmeanclean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.198   1.339   1.439   1.504   1.532   2.231 

t.test(natStratRound1rtmeanclean,natStratRound2rtmeanclean, paired=T); # significant p =.04

# Participants are significantly faster in round 2 when doing natural then strategy.


# STRATEGY-NATURAL
# All trials
stratNatRound1rtmean = rcsSubLevelWide_clean$round1_RTmean[rcsSubLevelWide_clean$condCode==3];
stratNatRound2rtmean = rcsSubLevelWide_clean$round2_RTmean[rcsSubLevelWide_clean$condCode==3];
cond3rtdiffmean = mean(stratNatRound1rtmean- stratNatRound2rtmean);

summary(stratNatRound1rtmean);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.8911  1.2494  1.4350  1.4397  1.6361  1.9239 

summary(stratNatRound2rtmean);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.9585  1.1504  1.3378  1.3208  1.4315  1.8003 

t.test(stratNatRound1rtmean,stratNatRound2rtmean, paired=T); # significant difference, p =.0005

# remove fast trials
stratNatRound1rtmeanclean = rcsSubLevelWide_clean$round1_RTmeanClean[rcsSubLevelWide_clean$condCode==3];
stratNatRound2rtmeanclean = rcsSubLevelWide_clean$round2_RTmeanClean[rcsSubLevelWide_clean$condCode==3];
cond3rtdiffmeanclean = mean(stratNatRound1rtmeanclean- stratNatRound2rtmeanclean);

summary(stratNatRound1rtmeanclean);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.8911  1.2494  1.4350  1.4397  1.6361  1.9239 

summary(stratNatRound2rtmeanclean);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.9585  1.1504  1.3378  1.3208  1.4315  1.8003 

t.test(stratNatRound1rtmeanclean,stratNatRound2rtmeanclean, paired=T); # significant difference, p =.003

# participants significantly faster in round 2 when doing strategy then natural

# STRATEGY-STRATEGY
# All trials
stratStratRound1rtmean = rcsSubLevelWide_clean$round1_RTmean[rcsSubLevelWide_clean$condCode==4];
stratStratRound2rtmean = rcsSubLevelWide_clean$round2_RTmean[rcsSubLevelWide_clean$condCode==4];
cond4rtdiffmean = mean(stratStratRound1rtmean- stratStratRound2rtmean);

summary(stratStratRound1rtmean);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.9161  1.2033  1.4671  1.4071  1.5740  2.0312 
summary(stratStratRound2rtmean);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.9488  1.1278  1.3546  1.3309  1.4426  2.1852 

t.test(stratStratRound1rtmean,stratStratRound2rtmean, paired=T); # not significant, p =.174

# Remove fast trials
stratStratRound1rtmeanclean = rcsSubLevelWide_clean$round1_RTmeanClean[rcsSubLevelWide_clean$condCode==4];
stratStratRound2rtmeanclean = rcsSubLevelWide_clean$round2_RTmeanClean[rcsSubLevelWide_clean$condCode==4];
cond4rtdiffmeanclean = mean(stratStratRound1rtmeanclean- stratStratRound2rtmeanclean);

summary(stratStratRound1rtmeanclean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.167   1.380   1.539   1.506   1.606   2.040 
summary(stratStratRound2rtmeanclean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.150   1.264   1.399   1.436   1.542   2.185 

t.test(stratStratRound1rtmeanclean,stratStratRound2rtmeanclean, paired=T); # not significant, p =.1

# Faster RTs in round 2 when repeating strategy, but differences are not significant

# Overall, people are faster in round 2, regardless of condition/instructions.


# What about comparing strat vs nat in round 1 only:
# ALL TRIALS
natFirstRTmean = rcsSubLevelWide_clean$round1_RTmean[rcsSubLevelWide_clean$condCode %in% c(1,2)]; # people who do nat first

summary(natFirstRTmean);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.9459  1.2087  1.3528  1.4107  1.5822  2.3205 

stratFirstRTmean = rcsSubLevelWide_clean$round1_RTmean[rcsSubLevelWide_clean$condCode %in% c(3,4)]; # people who do strat first

summary(stratFirstRTmean);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.8911  1.2418  1.4595  1.4234  1.6064  2.0312 

t.test(natFirstRTmean, stratFirstRTmean); # ns, p= .7966

# No significant difference between natural and strategy RTs for people who do natural and strategy first.

# REMOVE FAST TRIALS
natFirstRTmeanclean = rcsSubLevelWide_clean$round1_RTmeanClean[rcsSubLevelWide_clean$condCode %in% c(1,2)]; # people who do nat first

summary(natFirstRTmeanclean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.186   1.367   1.455   1.521   1.649   2.331 

stratFirstRTmeanclean = rcsSubLevelWide_clean$round1_RTmeanClean[rcsSubLevelWide_clean$condCode %in% c(3,4)]; # people who do strat first

summary(stratFirstRTmeanclean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.167   1.388   1.529   1.526   1.669   2.040 

t.test(natFirstRTmeanclean, stratFirstRTmeanclean); # ns, p= .8983

# No significant difference between natural and strategy RTs for people who do natural and strategy first.



# Plot round 1 vs round 2 RT for each condition for all trials
# All trials
pdf(file.path(config$path$directory, config$path$shlab_figures,'meanRTAcrossRndsStratPlotsAlltrials.pdf'))
par(pty="s", mfrow= c(2,2))
plot(natNatRound1rtmean, natNatRound2rtmean, ylim=c(0,3), xlim=c(0,3), ylab="Act natural Round 2", xlab="Act natural Round 1", pch=16, cex = 1.5, col="blue", main=sprintf("Natural-Natural\n RT mean diff = %.2f",cond1rtdiffmean))
abline(a=0, b=1, col="grey")

plot(natStratRound1rtmean, natStratRound2rtmean, ylim=c(0,3), xlim=c(0,3), ylab="Strategy Round 2", xlab="Act natural Round 1", pch=16, cex = 1.5, col="green", main=sprintf("Natural-Strategy\n RT mean diff = %.2f",cond2rtdiffmean))
abline(a=0, b=1, col="grey")

plot(stratStratRound1rtmean, stratStratRound2rtmean, ylim=c(0,3), xlim=c(0,3), ylab="Act Natural Round 2", xlab="Strategy Round 1", pch=16, cex = 1.5, col="red", main=sprintf("Strategy-Natural\n RT mean diff = %.2f",cond3rtdiffmean))
abline(a=0, b=1, col="grey")

plot(stratStratRound1rtmean, stratStratRound2rtmean, ylim=c(0,3), xlim=c(0,3), ylab="Strategy Round 2", xlab="Strategy Round 1", pch=16, cex = 1.5, col="purple", main=sprintf("Strategy-Strategy\n RT mean diff = %.2f",cond4rtdiffmean))
abline(a=0, b=1, col="grey")

mtext("Average Reaction Time (all trials)", side = 3, line = - 2, outer = TRUE)
dev.off()



# Remove fast trials
pdf(file.path(config$path$directory, config$path$shlab_figures,'meanRTAcrossRndsStratPlotsNoFastTrials.pdf'))
par(pty="s", mfrow= c(2,2))
plot(natNatRound1rtmeanclean, natNatRound2rtmeanclean, ylim=c(0,3), xlim=c(0,3), ylab="Act natural Round 2", xlab="Act natural Round 1", pch=16, cex = 1.5, col="blue", main=sprintf("Natural-Natural\n RT mean diff = %.2f",cond1rtdiffmeanclean))
abline(a=0, b=1, col="grey")

plot(natStratRound1rtmeanclean, natStratRound2rtmeanclean, ylim=c(0,3), xlim=c(0,3), ylab="Strategy Round 2", xlab="Act natural Round 1", pch=16, cex = 1.5, col="green", main=sprintf("Natural-Strategy\n RT mean diff = %.2f",cond2rtdiffmeanclean))
abline(a=0, b=1, col="grey")

plot(stratStratRound1rtmeanclean, stratStratRound2rtmeanclean, ylim=c(0,3), xlim=c(0,3), ylab="Act Natural Round 2", xlab="Strategy Round 1", pch=16, cex = 1.5, col="red", main=sprintf("Strategy-Natural\n RT mean diff = %.2f",cond3rtdiffmeanclean))
abline(a=0, b=1, col="grey")

plot(stratStratRound1rtmeanclean, stratStratRound2rtmeanclean, ylim=c(0,3), xlim=c(0,3), ylab="Strategy Round 2", xlab="Strategy Round 1", pch=16, cex = 1.5, col="purple", main=sprintf("Strategy-Strategy\n RT mean diff = %.2f",cond4rtdiffmeanclean))
abline(a=0, b=1, col="grey")

mtext("Average Reaction Time (removed fast trials)", side = 3, line = - 2, outer = TRUE)
dev.off()



```


```{r RT-mean-of-medians}
# using MEANS OF THE MEDIAN reaction timse with two versions - all trials vs remove fast trials

# RTmedian = median with all trials
# RTmedianClean = mean removing fast trials (<1s) 
# There were 7600 trials across both rounds with RTs less than 1s and all 124 participants had trials with fast RTs ranging from 1 trial to 176 trials across both rounds
# There were more fast trials in round 2 relative to round 1 but the range of number of missed trials per participant in round 2 was smaller.

#summary(fastTriPerSubround1);
   # Min. 1st Qu.  Median    Mean  3rd Qu.    Max. 
   # 1.00    7.00   20.50   26.54   40.00  101.00 

#summary(fastTriPerSubround2);
   # Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   # 0.00   14.00   28.50   34.75   54.00   84.00 




# ACROSS INSTRUCTION TYPE
# all trials
summary(rcsSubLevelLong_clean$RTmedian[rcsSubLevelLong_clean$strategy==0]);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.8944  1.0831  1.1989  1.2481  1.3834  2.2637 

summary(rcsSubLevelLong_clean$RTmedian[rcsSubLevelLong_clean$strategy==1]);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.8293  1.1291  1.2684  1.2994  1.4408  2.1901 


# remove fast trials
summary(rcsSubLevelLong_clean$RTmedianClean[rcsSubLevelLong_clean$strategy==0]);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.106   1.225   1.314   1.358   1.446   2.264

summary(rcsSubLevelLong_clean$RTmedianClean[rcsSubLevelLong_clean$strategy==1]);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.088   1.258   1.362   1.399   1.488   2.190 


t.test(rcsSubLevelLong_clean$RTmedian[rcsSubLevelLong_clean$strategy==0],rcsSubLevelLong_clean$RTmedian[rcsSubLevelLong_clean$strategy==1]); #p=.1
t.test(rcsSubLevelLong_clean$RTmedianClean[rcsSubLevelLong_clean$strategy==0],rcsSubLevelLong_clean$RTmedianClean[rcsSubLevelLong_clean$strategy==1]); #p=.1

# Reaction times are not significantly different from each other across instruction type but direction is that people are slower in strategy



# ACROSS ROUNDS
# all trials
summary(rcsSubLevelWide_clean$round1_RTmedian);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.8293  1.1479  1.3061  1.3209  1.4776  2.2637

summary(rcsSubLevelWide_clean$round2_RTmedian);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.9176  1.0485  1.2050  1.2266  1.3312  2.1901 

# remove fast trials
summary(rcsSubLevelWide_clean$round1_RTmedianClean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.115   1.274   1.383   1.416   1.517   2.264 

summary(rcsSubLevelWide_clean$round2_RTmedianClean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.088   1.211   1.301   1.341   1.401   2.190 

t.test(rcsSubLevelWide_clean$round1_RTmedian, rcsSubLevelWide_clean$round2_RTmedian); # p = 003
t.test(rcsSubLevelWide_clean$round1_RTmedianClean, rcsSubLevelWide_clean$round2_RTmedianClean); # p = 003

# Reaction times significantly faster in round 2 relative to round 1


# NATURAL-NATURAL
# All trials
natNatRound1rtmedian = rcsSubLevelWide_clean$round1_RTmedian[rcsSubLevelWide_clean$condCode==1];
natNatRound2rtmedian = rcsSubLevelWide_clean$round2_RTmedian[rcsSubLevelWide_clean$condCode==1];
cond1rtdiffmedian = mean(natNatRound1rtmedian- natNatRound2rtmedian);

summary(natNatRound1rtmedian);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.8944  1.1328  1.1876  1.2538  1.4286  1.7661 

summary(natNatRound2rtmedian);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.9634  1.0189  1.0903  1.1465  1.2487  1.6210

t.test(natNatRound1rtmedian,natNatRound2rtmedian, paired=T); # significant difference, p = .0003

# remove fast trials
natNatRound1rtmedianclean= rcsSubLevelWide_clean$round1_RTmedianClean[rcsSubLevelWide_clean$condCode==1];
natNatRound2rtmedianclean = rcsSubLevelWide_clean$round2_RTmedianClean[rcsSubLevelWide_clean$condCode==1];
cond1rtdiffmedianclean = mean(natNatRound1rtmedianclean- natNatRound2rtmedianclean);

summary(natNatRound1rtmedianclean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.125   1.260   1.316   1.367   1.449   1.800 

summary(natNatRound2rtmedianclean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.122   1.194   1.224   1.271   1.360   1.655 

t.test(natNatRound1rtmedianclean,natNatRound2rtmedianclean, paired=T); # trending difference, p = .0961

# Participants are faster in round 2 when repeating natural condition and is stronger in dataset including all trials


# NATURAL-STRATEGY
# all trials
natStratRound1rtmedian = rcsSubLevelWide_clean$round1_RTmedian[rcsSubLevelWide_clean$condCode==2];
natStratRound2rtmedian = rcsSubLevelWide_clean$round2_RTmedian[rcsSubLevelWide_clean$condCode==2];
cond2rtdiffmedian = mean(natStratRound1rtmedian- natStratRound2rtmedian);

summary(natStratRound1rtmedian);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 0.961   1.167   1.302   1.368   1.482   2.264 
summary(natStratRound2rtmedian);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.9176  1.0782  1.2473  1.2804  1.3047  2.1901

t.test(natStratRound1rtmedian,natStratRound2rtmedian, paired=T); # significant difference, p = .005

# remove fast trials
natStratRound1rtmedianclean = rcsSubLevelWide_clean$round1_RTmedianClean[rcsSubLevelWide_clean$condCode==2];
natStratRound2rtmedianclean = rcsSubLevelWide_clean$round2_RTmedianClean[rcsSubLevelWide_clean$condCode==2];
cond2rtdiffmedianclean = mean(natStratRound1rtmedianclean- natStratRound2rtmedianclean);

summary(natStratRound1rtmedianclean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.151   1.295   1.420   1.453   1.520   2.264 
summary(natStratRound2rtmedianclean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.158   1.251   1.316   1.402   1.411   2.190 

t.test(natStratRound1rtmedianclean,natStratRound2rtmedianclean, paired=T); # trending p =.08

# Participants are faster in round 2 relative to round 1, an effect that is stronger when including all data


# STRATEGY-NATURAL
# All trials
stratNatRound1rtmedian = rcsSubLevelWide_clean$round1_RTmedian[rcsSubLevelWide_clean$condCode==3];
stratNatRound2rtmedian = rcsSubLevelWide_clean$round2_RTmedian[rcsSubLevelWide_clean$condCode==3];
cond3rtdiffmedian = mean(stratNatRound1rtmedian- stratNatRound2rtmedian);

summary(stratNatRound1rtmedian);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.8293  1.1792  1.3711  1.3480  1.5731  1.7637 

summary(stratNatRound2rtmedian);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 0.926   1.089   1.208   1.224   1.344   1.590 

t.test(stratNatRound1rtmedian,stratNatRound2rtmedian, paired=T); # significant difference, p =3.72x10-5

# remove fast trials
stratNatRound1rtmedianclean = rcsSubLevelWide_clean$round1_RTmedianClean[rcsSubLevelWide_clean$condCode==3];
stratNatRound2rtmedianclean = rcsSubLevelWide_clean$round2_RTmedianClean[rcsSubLevelWide_clean$condCode==3];
cond3rtdiffmedianclean = mean(stratNatRound1rtmedianclean- stratNatRound2rtmedianclean);

summary(stratNatRound1rtmedianclean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.168   1.310   1.417   1.442   1.586   1.783 

summary(stratNatRound2rtmedianclean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.106   1.222   1.318   1.342   1.424   1.671 

t.test(stratNatRound1rtmedianclean,stratNatRound2rtmedianclean, paired=T); # significant difference, p =.00036

# participants significantly faster in round 2 when doing strategy then natural

# STRATEGY-STRATEGY
# All trials
stratStratRound1rtmedian = rcsSubLevelWide_clean$round1_RTmedian[rcsSubLevelWide_clean$condCode==4];
stratStratRound2rtmedian = rcsSubLevelWide_clean$round2_RTmedian[rcsSubLevelWide_clean$condCode==4];
cond4rtdiffmedian = mean(stratStratRound1rtmedian- stratStratRound2rtmedian);

summary(stratStratRound1rtmedian);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.8704  1.1459  1.3738  1.3137  1.4766  1.9314
summary(stratStratRound2rtmedian);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.9183  1.0485  1.2593  1.2557  1.3385  2.1575 

t.test(stratStratRound1rtmedian,stratStratRound2rtmedian, paired=T); # not significant, p =.289

# Remove fast trials
stratStratRound1rtmedianclean = rcsSubLevelWide_clean$round1_RTmedianClean[rcsSubLevelWide_clean$condCode==4];
stratStratRound2rtmedianclean = rcsSubLevelWide_clean$round2_RTmedianClean[rcsSubLevelWide_clean$condCode==4];
cond4rtdiffmedianclean = mean(stratStratRound1rtmedianclean- stratStratRound2rtmedianclean);

summary(stratStratRound1rtmedianclean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
  # 1.167   1.380   1.539   1.506   1.606   2.040
summary(stratStratRound2rtmedianclean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.088   1.180   1.322   1.349   1.413   2.157

t.test(stratStratRound1rtmedianclean,stratStratRound2rtmedianclean, paired=T); # not significant, p =.2

# Faster RTs in round 2 when repeating strategy, but differences are not significant

# Overall, people tend to be faster in round 2, regardless of condition/instructions.


# What about comparing strat vs nat in round 1 only:
# ALL TRIALS
natFirstRTmedian = rcsSubLevelWide_clean$round1_RTmedian[rcsSubLevelWide_clean$condCode %in% c(1,2)]; # people who do nat first

summary(natFirstRTmedian);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.8944  1.1419  1.2422  1.3109  1.4607  2.2637 

stratFirstRTmedian = rcsSubLevelWide_clean$round1_RTmedian[rcsSubLevelWide_clean$condCode %in% c(3,4)]; # people who do strat first

summary(stratFirstRTmedian);
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.8293  1.1609  1.3726  1.3309  1.4840  1.9314 

t.test(natFirstRTmedian, stratFirstRTmedian); # ns, p= .6621

# No significant difference between natural and strategy RTs for people who do natural and strategy first.

# REMOVE FAST TRIALS
natFirstRTmedianclean = rcsSubLevelWide_clean$round1_RTmedianClean[rcsSubLevelWide_clean$condCode %in% c(1,2)]; # people who do nat first

summary(natFirstRTmedianclean);
  # Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.125   1.267   1.352   1.410   1.516   2.264 

stratFirstRTmedianclean = rcsSubLevelWide_clean$round1_RTmedianClean[rcsSubLevelWide_clean$condCode %in% c(3,4)]; # people who do strat first

summary(stratFirstRTmedianclean);
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 1.115   1.301   1.428   1.422   1.514   1.931 

t.test(natFirstRTmedianclean, stratFirstRTmedianclean); # ns, p= .7261

# No significant difference between natural and strategy RTs for people who do natural and strategy first.

# Plot round 1 vs round 2 RT for each condition for all trials
# All trials
pdf(file.path(config$path$directory, config$path$shlab_figures,'medianRTAcrossRndsStratPlotsAlltrials.pdf'))
par(pty="s", mfrow= c(2,2))
plot(natNatRound1rtmedian, natNatRound2rtmedian, ylim=c(0,3), xlim=c(0,3), ylab="Act natural Round 2", xlab="Act natural Round 1", pch=16, cex = 1.5, col="blue", main=sprintf("Natural-Natural\n RT mean of median diff = %.2f",cond1rtdiffmedian))
abline(a=0, b=1, col="grey")

plot(natStratRound1rtmedian, natStratRound2rtmedian, ylim=c(0,3), xlim=c(0,3), ylab="Strategy Round 2", xlab="Act natural Round 1", pch=16, cex = 1.5, col="green", main=sprintf("Natural-Strategy\n RT mean of median diff = %.2f",cond2rtdiffmedian))
abline(a=0, b=1, col="grey")

plot(stratStratRound1rtmedian, stratStratRound2rtmedian, ylim=c(0,3), xlim=c(0,3), ylab="Act Natural Round 2", xlab="Strategy Round 1", pch=16, cex = 1.5, col="red", main=sprintf("Strategy-Natural\n RT mean of median diff = %.2f",cond3rtdiffmedian))
abline(a=0, b=1, col="grey")

plot(stratStratRound1rtmedian, stratStratRound2rtmedian, ylim=c(0,3), xlim=c(0,3), ylab="Strategy Round 2", xlab="Strategy Round 1", pch=16, cex = 1.5, col="purple", main=sprintf("Strategy-Strategy\n RT mean of median diff = %.2f",cond4rtdiffmedian))
abline(a=0, b=1, col="grey")

mtext("Mean of median Reaction Time (all trials)", side = 3, line = - 2, outer = TRUE)
dev.off()



# Remove fast trials
pdf(file.path(config$path$directory, config$path$shlab_figures,'medianRTAcrossRndsStratPlotsNoFastTrials.pdf'))
par(pty="s", mfrow= c(2,2))
plot(natNatRound1rtmedianclean, natNatRound2rtmedianclean, ylim=c(0,3), xlim=c(0,3), ylab="Act natural Round 2", xlab="Act natural Round 1", pch=16, cex = 1.5, col="blue", main=sprintf("Natural-Natural\n RT mean of median diff = %.2f",cond1rtdiffmeanclean))
abline(a=0, b=1, col="grey")

plot(natStratRound1rtmedianclean, natStratRound2rtmedianclean, ylim=c(0,3), xlim=c(0,3), ylab="Strategy Round 2", xlab="Act natural Round 1", pch=16, cex = 1.5, col="green", main=sprintf("Natural-Strategy\n RT mean of median diff = %.2f",cond2rtdiffmeanclean))
abline(a=0, b=1, col="grey")

plot(stratStratRound1rtmedianclean, stratStratRound2rtmedianclean, ylim=c(0,3), xlim=c(0,3), ylab="Act Natural Round 2", xlab="Strategy Round 1", pch=16, cex = 1.5, col="red", main=sprintf("Strategy-Natural\n RT mean of median diff = %.2f",cond3rtdiffmeanclean))
abline(a=0, b=1, col="grey")

plot(stratStratRound1rtmedianclean, stratStratRound2rtmedianclean, ylim=c(0,3), xlim=c(0,3), ylab="Strategy Round 2", xlab="Strategy Round 1", pch=16, cex = 1.5, col="purple", main=sprintf("Strategy-Strategy\n RT mean of median diff = %.2f",cond4rtdiffmeanclean))
abline(a=0, b=1, col="grey")

mtext("Mean of median Reaction Time (removed fast trials)", side = 3, line = - 2, outer = TRUE)
dev.off()



```

### In all comparisons, both mean of mean and mean of median reaction times are faster in round 2 relative to round 1, regardless of strategy condition. 


```{r motivation-and-round-independence}
# How motivated were people?
rcsSubLevelWide_clean$motivationNumeric = as.numeric(rcsSubLevelWide_clean$motivation)
summary(rcsSubLevelWide_clean$motivationNumeric); # mean = 5.17; median = 5; min = 2; max = 7 (scale was 1-7)

# are there any differences in motivation across conditions (not that we'd expect this to happen on purpose but should check)
summary(rcsSubLevelWide_clean$motivationNumeric[rcsSubLevelWide_clean$condCode==1]); # mean = ~5
summary(rcsSubLevelWide_clean$motivationNumeric[rcsSubLevelWide_clean$condCode==2]); # mean = 5.26
summary(rcsSubLevelWide_clean$motivationNumeric[rcsSubLevelWide_clean$condCode==3]); # mean = 5.34
summary(rcsSubLevelWide_clean$motivationNumeric[rcsSubLevelWide_clean$condCode==4]); # mean = 5.1

hist(rcsSubLevelWide_clean$motivationNumeric, breaks=7, main= "Motivation ratings n=124\n mean = 5.17", xlab="motivation (1-7)", xlim=c(1,7))


# did the rounds feel independent to people? and did this depend on condition?

rcsSubLevelWide_clean$rdmRoundsIndepNumeric = as.numeric(rcsSubLevelWide_clean$rdmRoundsIndep)
summary(rcsSubLevelWide_clean$rdmRoundsIndepNumeric); # mean= 4.99; median = 5; range = 1-7 (on a scale from 1-7)

summary(rcsSubLevelWide_clean$rdmRoundsIndepNumeric[rcsSubLevelWide_clean$condCode==1]); # mean = 4.48
summary(rcsSubLevelWide_clean$rdmRoundsIndepNumeric[rcsSubLevelWide_clean$condCode==2]); # mean = 5.355
summary(rcsSubLevelWide_clean$rdmRoundsIndepNumeric[rcsSubLevelWide_clean$condCode==3]); # mean = 4.871
summary(rcsSubLevelWide_clean$rdmRoundsIndepNumeric[rcsSubLevelWide_clean$condCode==4]); # mean = 5.258

hist(rcsSubLevelWide_clean$rdmRoundsIndepNumeric, breaks=7, main= "RDM round independence\nn=124; mean = 4.99", xlab="independence ratings (1-7)", xlim=c(1,7))

```


```{r complex-span-tasks-ERQ}
 summary(rcsSubLevelWide_clean$ospan);# range = 0-25; mean =14.53; median = 13
 summary(rcsSubLevelWide_clean$symspan); # range = 0-14; mean = 7.657; median = 9
 summary(rcsSubLevelWide_clean$compositeSpanScore); # range = 0.06 - 1; median = .5743, mean = .5720

# are ospan and symspan correlated?
cor.test(rcsSubLevelWide_clean$ospan, rcsSubLevelWide_clean$symspan); # yes - r = .26, p = .009

 summary(rcsSubLevelWide_clean$ERQreapp); # range = 14-42; mean = 29.69; median =30
 summary(rcsSubLevelWide_clean$ERQsupp); # range = 4 - 27; mean = 14.89; median = 15
 

# Are instruction difficulty and frequency related to ERQ, motivation, or complex span?
rcsSubLevelLong_clean$strategyRecode = rcsSubLevelLong_clean$strategy;
rcsSubLevelLong_clean$strategyRecode[rcsSubLevelLong_clean$strategyRecode==0] = -1; # change 0s to -1


instDiff_model1 = lmer(instDifficult ~ 1+ compositeSpanScore + ERQreapp +  ERQsupp + strategyRecode + as.numeric(motivation) + (1|subID), data=rcsSubLevelLong_clean)
summary(instDiff_model1); # no main effects, trending effect of strategy with higher difficulty in strategy condition

instDiff_model2 = lmer(instDifficult ~ 1+ compositeSpanScore*strategyRecode + ERQreapp*strategyRecode +  ERQsupp*strategyRecode+ as.numeric(motivation)*strategyRecode+ (1|subID), data=rcsSubLevelLong_clean)
summary(instDiff_model2);
# no interaction with strategy

instHowOften_model1 = lmer(instHowOften ~ 1+ compositeSpanScore + ERQreapp +  ERQsupp + strategyRecode + as.numeric(motivation) + (1|subID), data=rcsSubLevelLong_clean)
summary(instHowOften_model1);
# no main effects

instHowOften_model2 = lmer(instHowOften ~ 1+ compositeSpanScore*strategyRecode*roundRecode + ERQreapp*strategyRecode +  ERQsupp*strategyRecode+ as.numeric(motivation)*strategyRecode +  (1|subID), data=rcsSubLevelLong_clean)
summary(instHowOften_model2);
# main effect of strategy (positive - higher frequency ratings in strategy condition)
# interaction between motiviation and strategy (negative interaction - )
-.69 *2 + -1*20.70981 + 2*-1*-3.60100 = -14.88781 # low motivation, natural -> effect is negative on frequency
-.69 *7 + -1*20.70981 + 7*-1*-3.60100 = -0.33281 # high motivation, natural -> effect is less negative on frequency 
-.69 *2 + 1*20.70981 + 2*1*-3.60100 = 12.12781 # low motivation, strategy -> effect is positive on frequency
-.69 *7 + 1*20.70981 + 7*1*-3.60100 = -9.32719 # high motivation, strategy -> effect is negative on frequency (what?)


# CONSIDER ADDING ROUND?

# rcsSubLevelLong_clean$roundRDM = rep(c(-1,1),times=nSub);  # round just gets dropped in the model

# instHowOften_model3 = lmer(instHowOften ~ 1+ compositeSpanScore*strategyRecode*roundRDM + ERQreapp*strategyRecode*roundRDM +  ERQsupp*strategyRecode*roundRDM+ as.numeric(motivation)*strategyRecode*roundRDM +  (1|subID), data=rcsSubLevelLong_clean)
# summary(instHowOften_model2);

```


### Generalized linear mixed effects models
#### Trial-level
##### There are a couple of possibilities here. Account for round and strategy in trial-level models or leave out to help detect interactions in subsequent (context models)
```{r trial-level-glmer}
# For our trial-level models, we tested two versions. Both included gain, safe and ev on trial t, but the second one included strategy and round. 
# We are going to move forward with model that accounts for strategy and round but will include the results from the basic model below.


# # model with gain, safe and EV level (magnitude)
# model1_trialLev =glmer(choice ~ 1 +  gainScaled + safeScaled + evLevScaled + (1|subID), data=rdmDFclean , family = "binomial")
# summary(model1_trialLev)
# # risk-taking increases as gain amounts increases and decreases as safe values increase and magnitude increases


# model with round and strategy (and interaction)
model3_trialLevRoundStrat= glmer(choice ~ 1 + gainScaled + safeScaled + evLevScaled + roundRecode*strategyRecode + (1|subID), data=rdmDFclean , family = "binomial")
summary(model3_trialLevRoundStrat)
# gain, safe, EV as above
# no main effect of round 
# main effect of strategy (more risk-taking in strategy condition)
# positive interaction between round and strategy 
  # this interaction means that the effect of each condition is stronger in round 2 (i.e. more risk-taking for strategy, esp in round 2 and less risk-taking in natural, esp round 2)

# Notes: because there is an interaction between round and strategy, we need to include both or none.

```


```{r trial-level-model-NOroundorstrategy}
# these results are using trial-level model with just gain, safe and ev (no round or strategy)

# # model with gain, safe and EV level (magnitude)
model1_trialLev =glmer(choice ~ 1 +  gainScaled + safeScaled + evLevScaled + (1|subID), data=rdmDFclean , family = "binomial");
summary(model1_trialLev);
# risk-taking increases as gain amounts increases and decreases as safe values increase and magnitude increases

# save predicted values
rdmDFclean$predModel1= predict(model1_trialLev,type="link"); 

# using predicted values from model 1 above (gain, safe, ev)
model_roundStrat_pred1= glm(choice ~ 0 + roundRecode*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_roundStrat_pred1)
# strategy is significant and positive, 
# positive interaction between round and strategy 
# more risk-taking when people are told to ignore context and this effect is stronger in round 2
# AIC = 30533

#PAST OUTCOME
model_poc_pred1 = glm(choice ~ 0 + pastOC1sc, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_poc_pred1)
# trending, negative beta is trending at p=.07
# AIC = 30289

# PAST OUTCOME INTXN WITH STRATEGY
model_pocStrat_pred1 = glm(choice ~ 0 + pastOC1sc*strategyRecode*roundRecode, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_pocStrat_pred1)
#no interaction, but outcome is still negative and trending
#AIC = 30281

#SHIFT
model_signedShiftStrat_pred1 = glm(choice ~ 0 + signedShiftsc*strategyRecode*roundRecode, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_signedShiftStrat_pred1)
# positive interaction bewteen strategy and round
# positive interaction between strategy, round and signed shift 
# AIC = 30527

#POSITIVE AND NEGATIVE SHIFT
model_posNegShift_pred1 = glm(choice ~ 0 + posShiftsc  + negShiftsc + strategyRecode*roundRecode, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_posNegShift_pred1) 
# trending effect of positive shift, significant effect of negative shift, positive interaction between strategy and round
# AIC = 30529

# POSITIVE AND NEGATIVE SHIFT WITH STRATEGY
model_posNegShiftStrat_pred1 = glm(choice ~ 0 + posShiftsc*strategyRecode*roundRecode + negShiftsc*strategyRecode*roundRecode, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_posNegShiftStrat_pred1) 
# AIC: 30527 (same as signedShift model with round x strategy)
# trending effect of positive shift
# main effect of stratgey, negative shift
# interaction bewteen strategy and positive shift, strategy and round
# interaction between strategy and round, interaction between strategy and negative shift (making negative shift stronger in strategy condition) 
# 0.774618*1*-.33 + 0.774618*-.33 - 0.041001*1 = -0.5522489 # strategy, large negative shift - effect on gambling is negative
# 0.774618*-1*-.33 + 0.774618*-.33 - 0.041001*-1 = 0.041001; # natural, large negative shift - effect on gambling is positive

# EARNINGS X EXPECTATIONS (I.E. TRIAL NORMALIZED)
model_earnsExp_pred1 = glm(choice ~ 0 + earnNormalizedOverall + trialSC, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_earnsExp_pred1)
# betas are in direction as expected and significant
# AIC = 30526


# EARNINGS AND EXPECTATIONS (TIME) INTERACTING
model_earnsExpIntxn_pred1 = glm(choice ~ 0 + earnNormalizedOverall*trialSC, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_earnsExpIntxn_pred1)
# effect of earnigns enx expectations as we'd expect, trending interaction between trial and earnings is positive
# beta estimates are so similar between expectations and earnings
# AIC: 30524

#EARNINGS, EXPECTATIONS AND STRATEGY x ROUND
model_earnsExpIntxn_pred1 = glm(choice ~ 0 + earnNormalizedOverall*trialSC*strategyRecode*roundRecode, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_earnsExpIntxn_pred1)
# main effect of expectation and earnings
# trending interaction bewteen earnings and expectations
# trending interaction beweeen earnings, expectation and strategy (positive)
# AIC: 30517

model_earnsExpIntxn_pred1 = glm(choice ~ 0 + earnNormalizedOverall*trialSC*strategyRecode + strategyRecode*roundRecode, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_earnsExpIntxn_pred1)
# main effect of expectation and earnings
# trending interaction bewteen earnings and expectations
# trending interaction beweeen earnings, expectation and strategy (positive)
# AIC: 30510
# better model is to account for interaction with strategy and separate interaction with strategy and round


# EARNINGS AND OUTCOME INTERACTION

model_earnsOCExpIntxn_pred1 = glm(choice ~ 0 + earnNormalizedOverall*pastOC1sc*trialSC + strategyRecode*roundRecode, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_earnsOCExpIntxn_pred1)
# AIC = AIC: 30237 (AIC = 30248 (when not accounting for roundxstrat))
# negative effect of past outcome
# positive effect of strategy
# intxn between earnings, poc; earnings and expectations; expectations and poc; and strategy x round

model_earnsOC_expOC_Intxn_pred1 = glm(choice ~ 0 + earnNormalizedOverall*pastOC1sc + earnNormalizedOverall*trialSC + trialSC*pastOC1sc + strategyRecode*roundRecode, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_earnsOC_expOC_Intxn_pred1);
# AIC = 30235
# removing the 3-way interaction between poc, earnings and expectation improves model
# results same as above

# PUT ALL TIMESCALES IN MODEL
model_3timescales_pred1 = glm(choice ~ 0 + pastOC1sc*earnNormalizedOverall + posShiftsc + negShiftsc + trialSC*pastOC1sc + strategyRecode*roundRecode,  data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_3timescales_pred1);
# AIC: 30230
# negative past outcome effect
# no positive shift effect
# negative shift effect
# positive effect of strategy
# interaction bewteen poc earnings and poc and expectations
# strategy x round interaction


model_3timescalesStrategy_pred1 = glm(choice ~ 0 + pastOC1sc*earnNormalizedOverall*strategyRecode*roundRecode + posShiftsc*strategyRecode*roundRecode + negShiftsc*strategyRecode*roundRecode + trialSC*pastOC1sc*strategyRecode*roundRecode,  data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_3timescalesStrategy_pred1)
# AIC: 30230
# big model
# main effect of past outcome and negative shift
# immediate timescale: negative past outcome effect that has a trending interaction with round
# neighborhood timescale: negative effect of shift, interaction between positive shift and strategy, interaction between negative eshift, round and strategy
# global timescale: round interacts with earnings (trending) and expectations
# immediate x global: poc interacts with earnings and expectations. there is also a 3-way interaction bewteen earnings, poc and round as well as poc round and expectations. 4-way interaction between poc, earnings, strategy and round as well as poc, expectations, earnings and round.


```

```{r plot-strategy-round-effect}

# using estimates from model3_trialLevRoundStrat:
model3summary = summary(model3_trialLevRoundStrat)

conditionBeta = model3summary$coefficients[6]
roundBeta = model3summary$coefficients[5]
condRoundIntxnBeta =model3summary$coefficients[7]

rounds = c(-1,-1,1,1); # round 1, round 1, round 2, round 2
conditions = c(-1,1,-1,1) # natural, strategy, natural, strategy

pgamRoundxCondition = 1/(1+exp(-1*( (conditionBeta*conditions) + (roundBeta*rounds) + (condRoundIntxnBeta*conditions*rounds) )));

# natural, round 1 pgam = 0.4909277
# natural, round 2  pgam = 0.4593623
# strategy, round 1 pgam = 0.5125908
# strategy, round 2 pgam = 0.5371388

pdf(file.path(config$path$directory, config$path$shlab_figures,'pgamRoundxCondition.pdf'))
#par(pty="s")

plot(c(pgamRoundxCondition[1], pgamRoundxCondition[3]),  ylim = c(.4,.6), pch=16, axes = F, lwd = 5, col="goldenrod1", ylab="P(gamble)", xlab="Round", cex = 2)
points(c(pgamRoundxCondition[2], pgamRoundxCondition[4]), pch=16, cex=2, col="tomato1")
axis(1, at=c(1,2), label=c("1", "2"), lwd=6, cex=1.5)
axis(2, lwd =6, cex=1.5)
abline(a=.5, b=0, col="darkgrey", lty="dashed", lwd=1)

legend("bottomright", legend=c("Act Natural", "Strategy"),pch =16, bty="n", col=c("goldenrod1","tomato1"), cex=1)
dev.off()
```

```{r save-predicted-values, echo=FALSE}
rdmDFclean$predModel3= predict(model3_trialLevRoundStrat,type="link"); 
```


### Recent event models
#### glmer models are showing up as singular - we will use glm, effects are nearly identical between glmer and glm versions
```{r recent-events-model-alldata}

# what happens when we account for strategy and round using predicted values from both of our trial level models

# using predicted avlues from model 3 above (gain, safe, ev, round and strategy)
model_roundStrat_pred3= glm(choice ~ 0 + roundRecode*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_roundStrat_pred3)
# no effects of round, strategy or interaction


# PAST OUTCOME
model_poc_pred3 = glm(choice ~ 0 + pastOC1sc, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_poc_pred3)
# negative trending effect of poc; p = 0.0703 .

# PAST OUTCOME INTXN WITH STRATEGY
model_pocStrat_pred3 = glm(choice ~ 0 + pastOC1sc*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_pocStrat_pred3)
# no interaction with strategy or main effect of strategy. poc is trending and negative


# SHIFT
model_signedShiftStrat_pred3 = glm(choice ~ 0 + signedShiftsc*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_signedShiftStrat_pred3)
# positive effect of signed shift (more risk-taking as shift increases)
# AIC: 30510


#POSITIVE AND NEGATIVE SHIFT

model_posNegShift_pred3 = glm(choice ~ 0 + posShiftsc  + negShiftsc, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_posNegShift_pred3)  
# positive shift is trending
# negative shift is significant (positve beta, but shift is negative, so less risk-taking with larger negative shifts)

# POSITIVE AND NEGATIVE SHIFT WITH STRATEGY
model_posNegShiftStrat_pred3 = glm(choice ~ 0 + posShiftsc*strategyRecode + negShiftsc*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_posNegShiftStrat_pred3)
#  these models with positive and negative shift (vs signed shift) are allowing asymmetries between the positive and negative shift effect 
# similar results above but with no main effect of strategy and significant effect of negative shift
# trending effect of positive shift
# interaction between positive shift and strategy (stronger effect of positive shift in strategy condition)
# AIC: 30509

#shift effect is comparing current vs previous shift but when we tell people to ignore recent things, they aren't thinking about current values (and how it changes from previous trial) as contextual effects. Perhaps is because its not accesible and so people can't defend against it in a way they could with past outcome.

# EARNINGS X EXPECTATIONS (I.E. TRIAL NORMALIZED)
model_earnsExp_pred3 = glm(choice ~ 0 + earnNormalizedOverall + trialSC, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_earnsExp_pred3)
# both significant in expected direction (positive effect of earnings; negative effect of expectations)
# AIC = 30496

# EARNINGS AND EXPECTATIONS (TIME) INTERACTING
model_earnsExpIntxn_pred3 = glm(choice ~ 0 + earnNormalizedOverall*trialSC, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_earnsExpIntxn_pred3)
# betas for earnings and expectations nearly the same and direction is as expected. Trending interaction between them. 
# AIC = 30494 
(.8786*.5) - (.8538*.5) + (.5*.5*.2963); # earnings = expectations effect on gambling: 0.086475 
(.8786*1) - (.8538*.5) + (1*.5*.2963); # earnings > expectations effect on gambling: 0.59985
(.8786*.5) - (.8538*1) + (.5*1*.2963); # earnings < expectations effect on gambling: -0.26635
# when earnings are roughly equal to expectaions the net effect on gambling is small. When earnings are more than expected, the effect on gambling is positive and when earnings are less than expected the effect on gambling is negative.

#EARNINGS, EXPECTATIONS AND STRATEGY
model_earnsExpIntxn_pred3 = glm(choice ~ 0 + earnNormalizedOverall*trialSC*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_earnsExpIntxn_pred3)
# main effects and interaction hold up (now interaction is significant) but no interaction with strategy
# AIC = 30493 - accoutning for strategy improves AIC though


# Do people track earnings over rounds?
model_earningsOverrounds_pred3 = glm(choice ~0 + earningsAcrossRounds*trialSC, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_earningsOverrounds_pred3); 
# no main effect of earnings across rounds but trending interaction with expectation
# AIC = 30513

# and including trial over all
model_earningsandExpOverrounds_pred3 = glm(choice ~ 0 + earningsAcrossRounds*trialAcrossRounds, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_earningsandExpOverrounds_pred3);
# main effects of earnings overall and trial
# AIC = 30503

# so people could be tracking earnings and expectations over the two rounds but the AICs on these models are lower than earnings/expectations within round

# GLOBAL AND IMMEDIATE TIMESCALE INTERACTION
# does outcome interact with earnings/expectations?
model_earnsOcIntxn_pred3 = glm(choice ~ 0 + earnNormalizedOverall*trialSC*pastOC1sc, data=rdmDFclean, family="binomial", offset=predModel3);
summary(model_earnsOcIntxn_pred3)
# when adding past outcome, both main effects of earnings and expectation goes away and so does the interaction
# AIC: 30219

model_earnsOC_expOC_Intxn_pred3 = glm(choice ~ 0 + earnNormalizedOverall*pastOC1sc+ trialSC*pastOC1sc, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_earnsOC_expOC_Intxn_pred3)
# AIC: 30216
# negative effect of past outcome, interaction between earnings x poc and expectation x poc are significant (these interations have opposite betas)
# best model of tthe three compared here

# what if we just interact past outcome with earnings but include interaction bewteen earnings and expectations
model_earnsOCintxn_earnsExpintxn_pred3 = glm(choice ~ 0 + earnNormalizedOverall*pastOC1sc+ trialSC*earnNormalizedOverall, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_earnsOCintxn_earnsExpintxn_pred3)
# AIC = 30224
# main effects and intx between earnings and poc hold up - no interaction between earnings and expectations

# BEST MODEL HERE ACCOUNTS FOR INTERACTION BEWTEEN EARNINGS AND POC AND EXPECTATION AND POC
model_earnsOC_expOC_Intxn_strategy_pred3 = glm(choice ~ 0 + earnNormalizedOverall*pastOC1sc*strategyRecode+ trialSC*pastOC1sc*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_earnsOC_expOC_Intxn_strategy_pred3)
# AIC: 30219
# no interaction with strategy


# PUT ALL TIMESCALES IN MODEL
model_3timescales_pred3 = glm(choice ~ 0 + pastOC1sc*earnNormalizedOverall + posShiftsc + negShiftsc + trialSC*pastOC1sc,  data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_3timescales_pred3)
# AIC = 30212
# negative effect of past outcome, negative effect of negative shift, interaction between past outcome and earnings and past outcome and expectation


# All timescales with strategy
model_3timescalesStrategy_pred3 = glm(choice ~ 0 + pastOC1sc*earnNormalizedOverall*strategyRecode + posShiftsc*strategyRecode + negShiftsc*strategyRecode + trialSC*pastOC1sc*strategyRecode,  data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_3timescalesStrategy_pred3)
# AIC = 30213
# main effect of past outcome
# main effect of strategy (although negative here)
# main effect of negative shift
# positive interaction between past outcome and earnings
# positive effect between strategy and positive shift
# negative interaction between past outcome and expectations


# All timescales with strategy and round (bc there is an interaction bewteen strategy and round)
model_3timescalesStrategyRound_pred3 = glm(choice ~ 0 + pastOC1sc*earnNormalizedOverall*strategyRecode*roundRDM + posShiftsc*strategyRecode*roundRDM + negShiftsc*strategyRecode*roundRDM + trialSC*pastOC1sc*strategyRecode*roundRDM,  data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_3timescalesStrategyRound_pred3)
# AIC = 30219
# big model, lots of results to sift through
# main effects: past outcome, earnings, expectations
# two-interactions: round interacts with earnings and expectations; strategy interacts with negative shift
# three-way interactions: 
  # strategy and round both interact with poc and expectation
  # strategy (p=.055) and round both interact with poc and earnings
  # strategy x round  negative shift
  
# four-way interactions:
  # strategy and round interact with earnings x poc
  # strategy and round interact with expectations x poc

# Adding round does not improve the model but it does seem to make strategy stronger in some cases
```

```{r plot-big-model-results}
# haven't updated this
# first lets plot the effect of past outcome and strategy
# from big model, accounting for earnings and expectations across rounds using residuals model 3
pocBeta =  -0.34512
strategyBeta = -0.08747
pocXstrategyBeta= 0.06633 

poc = rep(seq(0,1, by=.1), times= 2)
strategy = rep(c(-1,1), each = length(poc)/2)
  
pgamPOCxStrategy= 1/(1+exp(-1*( (pocBeta*poc) + (strategyBeta*strategy) + (pocXstrategyBeta*poc*strategy) )));


pdf(file.path(config$path$directory, config$path$shlab_figures,'pgamPOCxStrategy.pdf'))
par(pty="s")
plot(pgamPOCxStrategy[1:11], type="l", ylim=c(.35,.6), ylab="P(gamble)", xlab="Past Outcome ($)", lwd=5, col = "goldenrod1", axes = F)
lines(pgamPOCxStrategy[12:22], lwd=5, col="tomato1")
abline(a=.5, b=0, lwd=3, lty="dashed", col = "darkgrey")
lines(pgamPOCxStrategy[1:11], lwd=5, col="goldenrod1")
axis(1, at = c(1,6,11), labels = c(0,30,61), lwd=5, cex = 1.5)
axis(2, lwd = 5, cex = 1.5)

legend("topright", legend=c("Act Natural", "Strategy"), lty=c("solid", "solid"),lwd = 3, bty="n", col=c("goldenrod1","tomato1"), cex=1.15)
dev.off()

# for presentation purposes, just plot act natural line
pdf(file.path(config$path$directory, config$path$shlab_figures,'pgamPOCxStrategy_actNatLineOnly.pdf'))
par(pty="s")
plot(pgamPOCxStrategy[1:11], type="l", ylim=c(.35,.6), ylab="P(gamble)", xlab="Past Outcome ($)", lwd=5, col = "goldenrod1", axes = F)
#lines(pgamPOCxStrategy[12:22], lwd=5, col="tomato1")
abline(a=.5, b=0, lwd=3, lty="dashed", col = "darkgrey")
lines(pgamPOCxStrategy[1:11], lwd=5, col="goldenrod1")
axis(1, at = c(1,6,11), labels = c(0,30,61), lwd=5, cex = 1.5)
axis(2, lwd = 5, cex = 1.5)

legend("topright", legend=c("Act Natural", "Strategy"), lty=c("solid", "solid"),lwd = 3, bty="n", col=c("goldenrod1","tomato1"), cex=1.15)
dev.off()


# plot shift effect
posShiftBeta = 0.43950 
negShiftBeta = 0.66468
posShiftStratIntxn = 0.77048
negShiftStratIntxn = -0.07737

posShiftAmts = rep(seq(0, .33, length.out = 3), times =2)
negShiftAmts = rep(seq(-.33, 0, length.out = 3), times = 2)
strategy = rep(c(-1,1), each = length(posShiftAmts)/2)

pgamPosshiftxStrategy= 1/(1+exp(-1*( (posShiftBeta*posShiftAmts) + (strategyBeta*strategy) + (posShiftStratIntxn*posShiftAmts*strategy) )));

pgamNegShiftxStrategy = 1/(1+exp(-1*( (negShiftBeta*negShiftAmts) + (strategyBeta*strategy) + (negShiftStratIntxn*negShiftAmts*strategy) )));

pdf(file.path(config$path$directory, config$path$shlab_figures,'pgamPosShiftxStrategy.pdf'))
par(pty="s")
plot(pgamPosshiftxStrategy[1:3], type="l", ylim=c(.4,.6), ylab="P(gamble)", xlab="Positive Shift ($)", lwd=5, col = "goldenrod1", axes = F)
lines(pgamPosshiftxStrategy[4:6], lwd=5, col="tomato1")
abline(a=.5, b=0, lwd=3, lty="dashed", col = "darkgrey")
lines(pgamPosshiftxStrategy[1:3], lwd=5, col="goldenrod1")
lines(pgamPosshiftxStrategy[4:6], lwd=5, col="tomato1")
axis(1, at = c(1:3), labels = c(0,10,20), lwd=5, cex = 1.5)
axis(2, lwd = 5, cex = 1.5)

legend("bottomright", legend=c("Act Natural", "Strategy"), lty=c("solid", "solid"),lwd = 3, bty="n", col=c("goldenrod1","tomato1"), cex=1.15)
dev.off()



pdf(file.path(config$path$directory, config$path$shlab_figures,'pgamPosShiftxStrategy_actNatLineOnly.pdf'))
par(pty="s")
plot(pgamPosshiftxStrategy[1:3], type="l", ylim=c(.4,.6), ylab="P(gamble)", xlab="Positive Shift ($)", lwd=5, col = "goldenrod1", axes = F)
#lines(pgamPosshiftxStrategy[4:6], lwd=5, col="tomato1")
abline(a=.5, b=0, lwd=3, lty="dashed", col = "darkgrey")
lines(pgamPosshiftxStrategy[1:3], lwd=5, col="goldenrod1")
#lines(pgamPosshiftxStrategy[4:6], lwd=5, col="tomato1")
axis(1, at = c(1:3), labels = c(0,10,20), lwd=5, cex = 1.5)
axis(2, lwd = 5, cex = 1.5)

#legend("bottomright", legend=c("Act Natural", "Strategy"), lty=c("solid", "solid"),lwd = 3, bty="n", col=c("goldenrod1","tomato1"), cex=1.15)
dev.off()



pdf(file.path(config$path$directory, config$path$shlab_figures,'pgamNegShiftxStrategy.pdf'))
par(pty="s")
plot(pgamNegShiftxStrategy[1:3], type="l", ylim=c(.35,.6), ylab="P(gamble)", xlab="Negative Shift ($)", lwd=5, col = "goldenrod1", axes = F)
lines(pgamNegShiftxStrategy[4:6], lwd=5, col="tomato1")
abline(a=.5, b=0, lwd=3, lty="dashed", col = "darkgrey")
lines(pgamNegShiftxStrategy[1:3], lwd=5, col="goldenrod1")
lines(pgamNegShiftxStrategy[4:6], lwd=5, col="tomato1")
axis(1, at = c(1:3), labels = c(-20,-10,0), lwd=5, cex = 1.5)
axis(2, lwd = 5, cex = 1.5)

legend("bottomright", legend=c("Act Natural", "Strategy"), lty=c("solid", "solid"),lwd = 3, bty="n", col=c("goldenrod1","tomato1"), cex=1.15)
dev.off()


```

```{r repeat-vs-switch-conditions}
# Could people who repeat conditions be more likely to track earnings over the rounds whereas people who switch strategies might reset between rounds?

# subset data for those who were in condition code 1 and 4
repeatconditions = c(condcode1, condcode4)
rdmDFrepeatCond = rdmDFclean[as.numeric(rdmDFclean$subID) %in% repeatconditions,]

model1_repeatcond_trialLevRoundStrat= glmer(choice ~ 1 + gainScaled + safeScaled + evLevScaled + roundRecode*strategyRecode + (1|subID), data=rdmDFrepeatCond , family = "binomial")
summary(model1_repeatcond_trialLevRoundStrat);# similar results as above

# get predicted values
rdmDFrepeatCond$pred= predict(model1_repeatcond_trialLevRoundStrat,type="link"); 

# THREE TIMESCALES
# earnings and expectations within round
model_repeatcond_3timescales = glm(choice ~ 0 + pastOC1sc*earnNormalizedOverall + posShiftsc + negShiftsc + trialSC*pastOC1sc, data=rdmDFrepeatCond, family="binomial", offset=pred);
summary(model_repeatcond_3timescales);
# AIC: 15036
# Main effect of past outcome
# Interaction between poc and earnings and poc and expectations
# trending effect of negative shift

# earnings and expectations across rounds
model_repeatcond_earnAcrossRnds_3timescales = glm(choice ~ 0 + pastOC1sc*earningsAcrossRounds + posShiftsc + negShiftsc + trialAcrossRounds*pastOC1sc, data=rdmDFrepeatCond, family="binomial", offset=pred);
summary(model_repeatcond_earnAcrossRnds_3timescales);
# AIC: 15037
# same effects as above, but lower AIC

# ADD STRATEGY
# earnings and expectations by round
model_repeatcond_3timescalesStrategy = glm(choice ~ 0 + pastOC1sc*earnNormalizedOverall*strategyRecode + posShiftsc*strategyRecode + negShiftsc*strategyRecode + trialSC*pastOC1sc*strategyRecode, data=rdmDFrepeatCond, family="binomial", offset=pred);
summary(model_repeatcond_3timescalesStrategy)
#  AIC = 15036
# for people who repeat conditions: 
# still seeing main effects of past outcome, interaction between poc and earnings, interaction between poc and expectations, trending negative shift effect, interaction between strategy and positive shift
# also seeing trending interaction between earnings and strategy (negative) and trending interaction between expectation and strategy

# earnings and expectations across round
model_repeatcond_3timescalesStrategy_earnExpAcrossRounds = glm(choice ~ 0 + pastOC1sc*earningsAcrossRounds*strategyRecode + posShiftsc*strategyRecode + negShiftsc*strategyRecode + trialAcrossRounds*pastOC1sc*strategyRecode, data=rdmDFrepeatCond, family="binomial", offset=pred)
summary(model_repeatcond_3timescalesStrategy_earnExpAcrossRounds)
# AIC = 15036
# AIC is identical to above when accounting for earnings within round and results are very similar

# should we be including both earnings and expectations across rounds or just earnings across rounds?
model_repeatcond_3timescalesStrategy_earnONLYAcrossRounds = glm(choice ~ 0 + pastOC1sc*earningsAcrossRounds*strategyRecode + posShiftsc*strategyRecode + negShiftsc*strategyRecode + trialSC*pastOC1sc*strategyRecode, data=rdmDFrepeatCond, family="binomial", offset=pred);
summary(model_repeatcond_3timescalesStrategy_earnONLYAcrossRounds);
# poc main effect, strategy x positive shift, trending poc and earnings across rounds
# AIC = 15055


# subset data for those who were in condition code 2 and 3
switchconditions = c(condcode2, condcode3)
rdmDFswitchCond = rdmDFclean[as.numeric(rdmDFclean$subID) %in% switchconditions,]

model1_switchcond_trialLevRoundStrat= glmer(choice ~ 1 + gainScaled + safeScaled + evLevScaled + roundRecode*strategyRecode + (1|subID), data=rdmDFswitchCond , family = "binomial")
summary(model1_switchcond_trialLevRoundStrat);
# no effect of round and no interaction between round and strategy for people who switch

# get predicted values
rdmDFswitchCond$pred= predict(model1_switchcond_trialLevRoundStrat,type="link"); 

# THREE TIMESCALES
# earnings and expectations by round
model_switchcond_3timescales = glm(choice ~ 0 + pastOC1sc*earnNormalizedOverall + posShiftsc + negShiftsc + trialSC*pastOC1sc, data=rdmDFswitchCond, family="binomial", offset=pred);
summary(model_switchcond_3timescales);
# AIC = 15162
# same as people who repeat, but no trending effect of negative shift here.

# earnings and trial by round
model_switchcond_earnAcrossRnds_3timescales = glm(choice ~ 0 + pastOC1sc*earningsAcrossRounds + posShiftsc + negShiftsc + trialAcrossRounds*pastOC1sc, data=rdmDFswitchCond, family="binomial", offset=pred);
summary(model_switchcond_earnAcrossRnds_3timescales);
# AIC: 15176
# same results as above, but with interaction between poc and earnings acros rounds and poc and expectations across rounds

# ADD STRATEGY
# earnings and expectations by round
model_switchcond_3timescalesStrategy = glm(choice ~ 0 + pastOC1sc*earnNormalizedOverall*strategyRecode + posShiftsc*strategyRecode + negShiftsc*strategyRecode + trialSC*pastOC1sc*strategyRecode, data=rdmDFswitchCond, family="binomial", offset=pred);
summary(model_switchcond_3timescalesStrategy);
# AIC = 15167
# only main effects of past outcome, earnings x poc and poc x expectations

# earnings and expectations across rounds
model_switchcond_3timescalesStrategy_earnExpAcrossRounds = glm(choice ~ 0 + pastOC1sc*earningsAcrossRounds*strategyRecode + posShiftsc*strategyRecode + negShiftsc*strategyRecode + trialAcrossRounds*pastOC1sc*strategyRecode, data=rdmDFswitchCond, family="binomial", offset=pred)
summary(model_switchcond_3timescalesStrategy_earnExpAcrossRounds)
# AIC: 15183
# still main effect of poc, interaction bewteen poc earnings across rounds, poc and expectations, trending interaction between earnings and strategy as well as strategy and expectations; significant interaction between strategy, past outcome, earnings and strategy past outcome and expectations.

# should we be including both earnings and expectations across rounds or just earnings across rounds?
model_switchcond_3timescalesStrategy_earnONLYAcrossRounds = glm(choice ~ 0 + pastOC1sc*earningsAcrossRounds*strategyRecode + posShiftsc*strategyRecode + negShiftsc*strategyRecode + trialSC*pastOC1sc*strategyRecode, data=rdmDFswitchCond, family="binomial", offset=pred);
summary(model_switchcond_3timescalesStrategy_earnONLYAcrossRounds);
# nothing is significant except past outcome
# AIC = AIC: 15184


# PEOPLE WHO SWITCH:
# the global timescale effects are stronger (trending interactions for repeat dataset) than for people who repeat.
# for 3 timescales only: the model that accounts for global effects over rounds are better in terms of AIC
# strategy: better model is one with earnings and trial by round, no interaction between strategy with any timescales in the better fitting model but in model that accounts for earnings and expectations across rounds, there is an interaction between strategy and global timescale effects

# PEOPLE WHO REPEAT:
# trending negative effect of shift show up but not for people who switch
# the model that accounts for global effects over rounds is slightly worse as one that doesn't in terms of AIC
# strategy: both models with strategy have same AIC (i.e. adding earnings across rounds doesn't improve model fit). In both models, strategy interactions with positive shift and has a trending interaction with earnings and expectations separately.


```

```{r, subset-round1-data}

rdmRound1df = rdmDFclean[rdmDFclean$roundRDM==1,]; # subset data for just round 1 folks

model_round1_triLevelStrat = glmer(choice ~ 1 + gainScaled + safeScaled + evLevScaled + strategyRecode + (1|subID), data=rdmRound1df , family = "binomial")
summary(model_round1_triLevelStrat)
# gain, safe and ev as expected
# no effect of strategy

rdmRound1df$predRnd1TriLev= predict(model_round1_triLevelStrat,type="link"); 

model_round1_3timescales = glm(choice ~ 0 + pastOC1sc + posShiftsc+ negShiftsc + trialSC + earnNormalizedOverall, data=rdmRound1df, family="binomial", offset=predRnd1TriLev)
summary(model_round1_3timescales)
# negative past outcome effect, negative effect of negative shift (beta is positive, shift is negative), negative effect of trial and positive earnings
# AIC = 15195

model_round1_earnExpIntxn_3timescales = glm(choice ~ 0 + pastOC1sc + posShiftsc+ negShiftsc + trialSC*earnNormalizedOverall, data=rdmRound1df, family="binomial", offset=predRnd1TriLev)
summary(model_round1_earnExpIntxn_3timescales)
# negative past outcome effect, negative effect of negative shift (beta is positive, shift is negative), negative effect of trial and earnings, no interaction bt earnings and expectations
# AIC = 15197

model_round1_pocEarnExpIntxn_3timescales = glm(choice ~ 0 + pastOC1sc*earnNormalizedOverall + posShiftsc+ negShiftsc + trialSC*pastOC1sc, data=rdmRound1df, family="binomial", offset=predRnd1TriLev)
summary(model_round1_3timescales)
# past outcome effect only, no interaction with poc
# AIC = 15191

model_round1_pocEarnIntxn_3timescales = glm(choice ~ 0 + pastOC1sc*earnNormalizedOverall + posShiftsc+ negShiftsc + trialSC, data=rdmRound1df, family="binomial", offset=predRnd1TriLev)
summary(model_round1_pocEarnIntxn_3timescales)
# past outcome effect, main effect of earnings, trending effect of expectation and sig. interaction between past outcome and earnings
# AIC = 15189

model_round1_pocExpIntxn_3timescales = glm(choice ~ 0 + earnNormalizedOverall + posShiftsc+ negShiftsc + pastOC1sc*trialSC, data=rdmRound1df, family="binomial", offset=predRnd1TriLev)
summary(model_round1_pocExpIntxn_3timescales)
# past outcome effect, main effect of earnings and expectations, interaction between past outcome and expectations
# AIC = 15190

# for just round 1 data, lowest AIC model is one that has interaction bewteen past outcome and earnings. 

# ADD STRATEGY
model_round1_pocEarnIntxn_strategy_3timescales = glm(choice ~ 0 + pastOC1sc*earnNormalizedOverall*strategyRecode + posShiftsc*strategyRecode+ negShiftsc*strategyRecode + trialSC*strategyRecode, data=rdmRound1df, family="binomial", offset=predRnd1TriLev)
summary(model_round1_pocEarnIntxn_strategy_3timescales)
# main effects of past outcome and earnings. Trending interaction betweeen poc and earnings
# interaction between strategy and positive shift and strategy and negative shift
# AIC = 15192

```


```{r individual-differences}

# Look at past outcome effect and strategy in people who do both control and strategy

# For each participant, fit trial-level model then past outcome
subsTriLevMods = list();
#subsPocMods = list();
subsContextMods = list();
trialLevelResults = as.data.frame(matrix(data = NA, nrow = nSub, ncol=3, dimnames=list(c(NULL), c("subID","beta","pval"))))
#contextResultColNames = c("subID", "pocBeta", "pocPval","stratBeta", "stratPval", "pocStratBeta", "pocStratPval", "roundBeta", "roundPval")
contextResultColNames = c("subID", "pocBeta", "pocPval","stratBeta", "stratPval", "pocStratBeta", "pocStratPval")
contextResults = as.data.frame(matrix(data=NA,nrow=nSub, ncol=length(contextResultColNames), dimnames=list(c(NULL), contextResultColNames)));



for (s in 1:nSub) {
  sub = rdmDFclean[rdmDFclean$subID==subIDchar[s],]; # pull out a single subject
  
  if(length(unique(diff(sub$strategyRecode)))>1){; # people switch strategiesin the study...
    subsTriLevMods[[s]] = glm(choice~gainScaled + safeScaled + evLevScaled, data=sub, family="binomial"); # run the trial level model
    
    sub$pred = predict(subsTriLevMods[[s]],type='link'); # get predicted values
    
    subsContextMods[[s]] = glm(choice~pastOC1sc*strategyRecode, data=sub, family="binomial", offset=pred); 
    #subsContextMods[[s]] = glm(choice~pastOC1sc*strategyRecode*roundRDM, data=sub, family="binomial", offset=pred); # doesn't work well
    
    tmp =summary(subsContextMods[[s]]); #store coefficients from poc model
    contextResults$subID[s] = subIDchar[s]; # fill in sub ID
    contextResults$pocBeta[s] = tmp$coefficients[[2]]; # store poc beta
    contextResults$pocPval[s] = tmp$coefficients[[14]]; # store poc pvalue
    contextResults$stratBeta[s] = tmp$coefficients[[3]]; # store strategy beta
    contextResults$stratPval[s] = tmp$coefficients[[15]]; # store strat pvalue
    contextResults$pocStratBeta[s] = tmp$coefficients[[4]]; # store intxn beta
    contextResults$pocStratPval[s] = tmp$coefficients[[16]]; # store intxn pvalue
  }
  
}; 

print(contextResults)
contextResults = contextResults[is.finite(contextResults$pocBeta),]; # remove NA rows

# POC
  # about half(30) have a negative effect of past outcome; 5 are significant
  # the other half (32) have a positive effect of past outcome; 2 are significant

# Strategy 
  # 39 people have positive effects of strategy and 11 are significant
  # 23 people have negative effects of strategy and 9 are significant

# POC x Strategy
  # 28 people have negative interaction between poc and strategy and 3 are significant
  # 34 people have positive interaction between poc and strategy and 7 are significant

```
