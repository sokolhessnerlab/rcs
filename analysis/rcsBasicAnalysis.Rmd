---
title: "RCS Basic Analysis"
author: "Hayley Brooks"
date: "2022-10-12"
output: html_document
---

```{r setup, include=FALSE}
rm(list=ls())

library('config')
config = config::get()


setup_source = file.path(config$path$code_files$dataSetUp) # run our set up script (which loads all the data)
source(setup_source) #, local = knitr::knit_global())
```

#### How many participants are in each condition/order?
```{r conditions, echo=FALSE}

cat("participants in natural-natural condition:",sum(rcsSubLevelWide_clean$condCode==1), "\nparticipants in natural-strategy condition:",sum(rcsSubLevelWide_clean$condCode==2), "\nparticipants in strategy-natural condition:",sum(rcsSubLevelWide_clean$condCode==3),"\nparticipants in strategy-strategy condition:", sum(rcsSubLevelWide_clean$condCode==4))


condcode1 = rcsSubLevelWide_clean$subID[rcsSubLevelWide_clean$condCode==1]
condcode2 = rcsSubLevelWide_clean$subID[rcsSubLevelWide_clean$condCode==2]
condcode3 = rcsSubLevelWide_clean$subID[rcsSubLevelWide_clean$condCode==3]
condcode4 = rcsSubLevelWide_clean$subID[rcsSubLevelWide_clean$condCode==4]
```


#### Average change in risk-taking across conditions
```{r, risk-taking-across-rounds, echo=FALSE}

# differences in pgam from round 1 to round 2:
pgamDiff = rcsSubLevelWide_clean$round1_pgamble - rcsSubLevelWide_clean$round2_pgamble

cat("\nChange in risk-taking from round1 to round 2 \n(round 1-round2)\n",mean(pgamDiff))

# pgamble diff between round 1 and 2 across conditions
# control, control

cat("\n\nDifference in risk-taking across rounds \nnatural(round1) - natural (round2)\ndiff p(gamble)",mean(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$subID %in% as.numeric(condcode1)] - rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$subID %in% as.numeric(condcode1)]))


# control, strategy
cat("\n\nDifference in risk-taking across rounds \nnatural(round1) - strategy (round2)\ndiff p(gamble)",mean(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$subID %in% as.numeric(condcode2)] - rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$subID %in% as.numeric(condcode2)]))

# strategy, control
cat("\n\nDifference in risk-taking across rounds \nstrategy(round1) - natural (round2)\ndiff p(gamble)",mean(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$subID %in% as.numeric(condcode3)] - rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$subID %in% as.numeric(condcode3)]))

# strategy, strategy
cat("\n\nDifference in risk-taking across rounds \nstrategy(round1) - strategy (round2)\ndiff p(gamble)",mean(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$subID %in% as.numeric(condcode4)] - rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$subID %in% as.numeric(condcode4)]))

```

#### Plot change in risk-taking across rounds and conditions
##### More risk taking in strategy condition (regardless of order)
```{r plot-basics, echo=FALSE}

#pdf("/Users/hayley/Desktop/shenhavLabTalk/risk-taking_rounds.pdf")
# plot(RDMqualityCheck$pgambleRound1[-c(12,15)]-RDMqualityCheck$pgambleRound2[-c(12,15)], ylab ="pGamble(round 1 - round 2)", xlab="participant", main="change in risk-taking across rounds", axes=F, pch=16, col="maroon", cex=1.5, ylim=c(-.4,.4), xlim=c(1,24))
# abline(h=0, col="grey", lty="dashed")
# axis(1, at = 1:nSub, labels = 1:nSub, lwd=3)
# axis(2, at = seq(-.4, .4, .1), lwd=3)
#dev.off()


# create a variable for condition code
# 1 = control, control
# 2 = control, strategy
# 3 = strategy, control
# 4 = strategy, strategy

#pdf("/Users/hayley/Desktop/shenhavLabTalk/rpgamByRoundAllcond.pdf")
par(pty="s")
plot(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$condCode==1], rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$condCode==1], asp=1,col="blue", pch=16, ylim=c(0,1), xlim=c(0,1), ylab="p(gamble round 1)", xlab="p(gamble round 2)", axes=F, cex=2)

abline(a = 0, b=1, lty="dashed", col="darkgrey",lwd=5)

points(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$condCode==2], rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$condCode==2], col="green",asp=1, pch=16,cex=2)

points(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$condCode==3], rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$condCode==3], asp=1, col="red", pch=16, cex=2)


points(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$condCode==4], rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$condCode==4], asp= 1,col="purple", pch=16, cex=2)
axis(1, lwd=6)
axis(2, lwd=6)
legend("bottomright", legend=c("nat-nat","nat-strat", "strat-nat" ,"strat-strat"), pch=16, bty="n", col=c("blue", "green", "red", "purple"), cex=1)

#dev.off()


#pdf("/Users/hayley/Desktop/shenhavLabTalk/rpgamDiff_cond2_cond3.pdf")
plot(c(rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$condCode==2]- rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$condCode==2], rcsSubLevelWide_clean$round1_pgamble[rcsSubLevelWide_clean$condCode==3]- rcsSubLevelWide_clean$round2_pgamble[rcsSubLevelWide_clean$condCode==3]), pch=16, ylab="Risk-taking\n (round 1 - round 2)", xlab="participant", ylim=c(-.5,.5),cex= 2,col=c(rep("green",length(condcode2)), rep("red", length(condcode3))), axes=F)
axis(1, at =1:sum(rcsSubLevelWide_clean$condCode %in% c(2,3)), labels = as.numeric(c(rcsSubLevelWide_clean$subID[rcsSubLevelWide_clean$condCode==2], rcsSubLevelWide_clean$subID[rcsSubLevelWide_clean$condCode==3])), lwd=6, cex.axis=1)
axis(2, lwd=6, cex=1.5)
abline(h=0, col="darkgrey", lty="dashed", lwd=4)

legend("bottomright", legend=c("nat-strat", "strat-nat"), pch=16, bty="n", col=c("green","red"), cex=1)
#dev.off()



```


#### Post round difficulty ratings
```{r instDifficulty-ratings}
# summary stats for diffciculty ratings in each condition and order
# participant generally felt that strategy was more difficult, on average.
summary(rcsSubLevelLong_clean$instDifficult[rcsSubLevelLong_clean$strategy==0])
summary(rcsSubLevelLong_clean$instDifficult[rcsSubLevelLong_clean$strategy==1])

# for participants who did natural condition both rounds, difficulty ratings is on average, higher for second round
natNatRound1difficulty = rcsSubLevelWide_clean$round1_instDifficult[rcsSubLevelWide_clean$condCode==1]
natNatRound2difficulty = rcsSubLevelWide_clean$round2_instDifficult[rcsSubLevelWide_clean$condCode==1]

summary(natNatRound1difficulty)
summary(natNatRound2difficulty)


# for participants who did natural then strategy, difficulty rating is on average, higher for second round (strategy harder)
natStratRound1difficulty = rcsSubLevelWide_clean$round1_instDifficult[rcsSubLevelWide_clean$condCode==2]
natStratRound2difficulty = rcsSubLevelWide_clean$round2_instDifficult[rcsSubLevelWide_clean$condCode==2]

summary(natStratRound1difficulty)
summary(natStratRound2difficulty)

# for participants who did strategy then natural, difficulty rating is on average, higher for first round (strategy harder)
stratNatRound1difficulty = rcsSubLevelWide_clean$round1_instDifficult[rcsSubLevelWide_clean$condCode==3]
stratNatRound2difficulty = rcsSubLevelWide_clean$round2_instDifficult[rcsSubLevelWide_clean$condCode==3]

summary(stratNatRound1difficulty)
summary(stratNatRound2difficulty)

# for participants who did strategy then strategy, difficulty rating is on average, higher for first round 
stratStratRound1difficulty = rcsSubLevelWide_clean$round1_instDifficult[rcsSubLevelWide_clean$condCode==4]
stratStratRound2difficulty = rcsSubLevelWide_clean$round2_instDifficult[rcsSubLevelWide_clean$condCode==4]

summary(stratStratRound1difficulty)
summary(stratStratRound2difficulty)

# these results suggest that we could use the round 1 ratings for natural vs strategy to compare 

pdf(file.path(config$path$directory, config$path$shlab_figures,'InstDifficultyRatingPlots.pdf'))
par(pty="s", mfrow= c(2,2))
plot(natNatRound1difficulty, natNatRound2difficulty, ylim=c(0,100), xlim=c(0,100), ylab="Act natural Round 2", xlab="Act natural Round 1", pch=16, cex = 1.5, col="blue")
abline(a=0, b=1, col="grey")

plot(natStratRound1difficulty, natStratRound2difficulty, ylim=c(0,100), xlim=c(0,100), ylab="Strategy Round 2", xlab="Act natural Round 1", pch=16, cex = 1.5, col="green")
abline(a=0, b=1, col="grey")

plot(stratNatRound1difficulty, stratNatRound2difficulty, ylim=c(0,100), xlim=c(0,100), ylab="Act Natural Round 2", xlab="Strategy Round 1", pch=16, cex = 1.5, col="red")
abline(a=0, b=1, col="grey")

plot(stratStratRound1difficulty, stratStratRound2difficulty, ylim=c(0,100), xlim=c(0,100), ylab="Strategy Round 2", xlab="Strategy Round 1", pch=16, cex = 1.5, col="purple")
abline(a=0, b=1, col="grey")

mtext("Instruction Difficulty Ratings", side = 3, line = - 2, outer = TRUE)
dev.off()

```


#### Post round how often ratings
```{r instFrequency-ratings}
# summary stats for how often ratings in each condition and order

# participants rated, on average, that they were able to follow instructions about 74% of the time with a slightly higher rating reported for the strategy condition
summary(rcsSubLevelLong_clean$instHowOften[rcsSubLevelLong_clean$strategy==0])
summary(rcsSubLevelLong_clean$instHowOften[rcsSubLevelLong_clean$strategy==1])


# for participants who did natural condition both rounds, participants felt they followed task instructions roughly the same amount of time across rounds
natNatRound1howOften = rcsSubLevelWide_clean$round1_instHowOften[rcsSubLevelWide_clean$condCode==1]
natNatRound2howOften = rcsSubLevelWide_clean$round2_instHowOften[rcsSubLevelWide_clean$condCode==1]

summary(natNatRound1howOften)
summary(natNatRound2howOften)


# for participants who did natural then strategy, participants report implementing strategy condition less often than acting natural (rather large difference)
natStratRound1howOften = rcsSubLevelWide_clean$round1_instHowOften[rcsSubLevelWide_clean$condCode==2]
natStratRound2howOften = rcsSubLevelWide_clean$round2_instHowOften[rcsSubLevelWide_clean$condCode==2]

summary(natStratRound1howOften)
summary(natStratRound2howOften)

# for participants who did strategy then natural, participants report implementing act natural instructions slightly more often than strategy (smaller difference than above)
# harder to act natural after doing strategy (even though strategy was implemented less of the time)
stratNatRound1howOften = rcsSubLevelWide_clean$round1_instHowOften[rcsSubLevelWide_clean$condCode==3]
stratNatRound2howOften = rcsSubLevelWide_clean$round2_instHowOften[rcsSubLevelWide_clean$condCode==3]

summary(stratNatRound1howOften)
summary(stratNatRound2howOften)

# for participants who did strategy then strategy, participants rated following instructions more, on average, in the first round, relative to second round.
stratStratRound1howOften = rcsSubLevelWide_clean$round1_instHowOften[rcsSubLevelWide_clean$condCode==4]
stratStratRound2howOften = rcsSubLevelWide_clean$round2_instHowOften[rcsSubLevelWide_clean$condCode==4]

summary(stratStratRound1howOften)
summary(stratStratRound2howOften)

# although people feel like natural and strategy are different in difficulty, it looks like they are able to do implement them roughly the same amount of time (here we are seeing averages for all 70-80%)

pdf(file.path(config$path$directory, config$path$shlab_figures,'InstFrequencyRatingPlots.pdf'))
par(pty="s", mfrow= c(2,2))
plot(natNatRound1howOften, natNatRound2howOften, ylim=c(0,100), xlim=c(0,100), ylab="Act natural Round 2", xlab="Act natural Round 1", pch=16, cex = 1.5, col="blue")
abline(a=0, b=1, col="grey")

plot(natStratRound1howOften, natStratRound2howOften, ylim=c(0,100), xlim=c(0,100), ylab="Strategy Round 2", xlab="Act natural Round 1", pch=16, cex = 1.5, col="green")
abline(a=0, b=1, col="grey")

plot(stratNatRound1howOften, stratNatRound2howOften, ylim=c(0,100), xlim=c(0,100), ylab="Act Natural Round 2", xlab="Strategy Round 1", pch=16, cex = 1.5, col="red")
abline(a=0, b=1, col="grey")

plot(stratStratRound1howOften, stratStratRound2howOften, ylim=c(0,100), xlim=c(0,100), ylab="Strategy Round 2", xlab="Strategy Round 1", pch=16, cex = 1.5, col="purple")
abline(a=0, b=1, col="grey")

mtext("Instruction Frequency Ratings", side = 3, line = - 2, outer = TRUE)
dev.off()

```

#### average RT across conditions

```{r RT-conditions}

# On average, participants are slower to respond in the strategy condition
summary(rcsSubLevelLong_clean$RT[rcsSubLevelLong_clean$strategy==0])
summary(rcsSubLevelLong_clean$RT[rcsSubLevelLong_clean$strategy==1])


# for participants who did natural then natural, they are, on average, faster in the second round
natNatRound1rt = rcsSubLevelWide_clean$round1_RT[rcsSubLevelWide_clean$condCode==1]
natNatRound2rt = rcsSubLevelWide_clean$round2_RT[rcsSubLevelWide_clean$condCode==1]

summary(natNatRound1rt)
summary(natNatRound2rt)

# for participants who did natural then strategy, they are slightly slower in the first round (natural)
natStratRound1rt = rcsSubLevelWide_clean$round1_RT[rcsSubLevelWide_clean$condCode==2]
natStratRound2rt = rcsSubLevelWide_clean$round2_RT[rcsSubLevelWide_clean$condCode==2]

summary(natStratRound1rt)
summary(natStratRound2rt)


# for participants who did strategy then natural, they are slightly slower in the first round (strategy) relative to second (natural) but the difference is very  small
stratNatRound1rt = rcsSubLevelWide_clean$round1_RT[rcsSubLevelWide_clean$condCode==3]
stratNatRound2rt = rcsSubLevelWide_clean$round2_RT[rcsSubLevelWide_clean$condCode==3]

summary(stratNatRound1rt)
summary(stratNatRound2rt)


# for participants who did strategy then strategy, they are faster in the second round
stratStratRound1rt = rcsSubLevelWide_clean$round1_RT[rcsSubLevelWide_clean$condCode==4]
stratStratRound2rt = rcsSubLevelWide_clean$round2_RT[rcsSubLevelWide_clean$condCode==4]

summary(stratStratRound1rt)
summary(stratStratRound2rt)

# when repeating instructions, participants are faster in second round. When switching, the difference is very small.


pdf(file.path(config$path$directory, config$path$shlab_figures,'rtAcrossRndsStratPlots.pdf'))
par(pty="s", mfrow= c(2,2))
plot(natNatRound1rt, natNatRound2rt, ylim=c(0,3), xlim=c(0,3), ylab="Act natural Round 2", xlab="Act natural Round 1", pch=16, cex = 1.5, col="blue")
abline(a=0, b=1, col="grey")

plot(natStratRound1rt, natStratRound2rt, ylim=c(0,3), xlim=c(0,3), ylab="Strategy Round 2", xlab="Act natural Round 1", pch=16, cex = 1.5, col="green")
abline(a=0, b=1, col="grey")

plot(stratStratRound1rt, stratStratRound2rt, ylim=c(0,3), xlim=c(0,3), ylab="Act Natural Round 2", xlab="Strategy Round 1", pch=16, cex = 1.5, col="red")
abline(a=0, b=1, col="grey")

plot(stratStratRound1rt, stratStratRound2rt, ylim=c(0,3), xlim=c(0,3), ylab="Strategy Round 2", xlab="Strategy Round 1", pch=16, cex = 1.5, col="purple")
abline(a=0, b=1, col="grey")

mtext("Average Reaction Time", side = 3, line = - 2, outer = TRUE)
dev.off()


```

Results above establish some similarities across that conditions: people take similar lengths of time and how often people are able to follow instructions is different (but similar ranges of values) even though people do think the strategy is more difficult. 


### Generalized linear mixed effects models
#### Trial-level
##### There are a couple of possibilities here. Account for round and strategy in trial-level models or leave out to help detect interactions in subsequent (context models)
```{r trial-level-glmer}

# model with gain, safe and EV level (magnitude)
model1_trialLev =glmer(choice ~ 1 +  gainScaled + safeScaled + evLevScaled + (1|subID), data=rdmDFclean , family = "binomial")
summary(model1_trialLev)
# risk-taking increases as gain amounts increases and decreases as safe values increase and magnitude increases
# AIC = 18413.7

# model with just round
model2_trialLevRound= glmer(choice ~ 1 + gainScaled + safeScaled + evLevScaled + roundRecode + (1|subID), data=rdmDFclean , family = "binomial")
summary(model2_trialLevRound)
# AIC = 18407.4
# gain, safe, EV as above
# positive, significant effect of round (coded -1 and 1 -> more risk-taking in round 2)

# model with round and strategy (and interaction)
model3_trialLevRoundStrat= glmer(choice ~ 1 + gainScaled + safeScaled + evLevScaled + roundRecode*strategyRecode + (1|subID), data=rdmDFclean , family = "binomial")
summary(model3_trialLevRoundStrat)
# AIC = 18392.4
# gain, safe, EV as above
# positive effect of round and strategy (stronger effect of strategy)
  # more risk-taking in round 2 and strategy condition
# positive, trending interaction between round and strategy 
  # this interaction would mean that the effect of each condition is stronger in round 2 (i.e. more risk-taking for strategy, esp in round 2 and less risk-taking in natural, esp round 2)


# Including round but not strategy in trial-model makes the subsequent analyses weird because there is a )potential) interaction between round and strategy. We either want to include both or none. Below, we will two analyses using predicted values (i.e. residuals) from model with just gain, safe, and EV and model with both round and strategy
```

```{r save-predicted-values, echo=FALSE}
rdmDFclean$predModel1= predict(model1_trialLev,type="link"); 


rdmDFclean$predModel3= predict(model3_trialLevRoundStrat,type="link"); 

# if you plot both of these predicted values, it it looks like there is a lot of unexplained gambling from these models where there are more predicted/residuals with values above 0 relative to below zero.

```


### Recent event models
#### glmer models are showing up as singular - we will use glm, effects are nearly identical between glmer and glm versions
```{r basic-recent-events-model}

# what happens when we account for strategy and round using predicted values from both of our trial level models
# using predicted values from model 1 above (gain, safe, ev)
model_roundStrat_pred1= glm(choice ~ 0 + roundRecode*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_roundStrat_pred1)
# we see similar effects but they are weaker in this model. 

# using predicted avlues from model 3 above (gain, safe, ev, round and strategy)
model_roundStrat_pred3= glm(choice ~ 0 + roundRecode*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_roundStrat_pred3)
# no effects of round, strategy or interaction


# PAST OUTCOME
model_poc_pred1 = glm(choice ~ 0 + pastOC1sc, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_poc_pred1)
# no outcome effect, negative beta but not significant

model_poc_pred3 = glm(choice ~ 0 + pastOC1sc, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_poc_pred3)
# no outcome effect, negative beta but not significant
# lower AIC than model above
# results are very similar as above


# PAST OUTCOME INTXN WITH STRATEGY
model_pocStrat_pred1 = glm(choice ~ 0 + pastOC1sc*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_pocStrat_pred1)
#positive interaction between past outcome and strategy but no main effects of outcome or strategy
# act natural large past outcome = 1*-.08 + -1*.002 + (1*-1*.17) = -.252
# strategy large past outcome = 1*-.08 + 1*.002 + (1*1*.17) = .092
#  when told to ignore back outcome, the weight of previous outcome is not negative and switches to positive (and is weaker)

model_pocStrat_pred3 = glm(choice ~ 0 + pastOC1sc*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_pocStrat_pred3)

# similar results above with positive interaction between outcome and strategy
# trending negative effect of strategy? p=.08
# AIC lower for this model


# SHIFT
model_signedShiftStrat_pred1 = glm(choice ~ 0 + signedShiftsc*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_signedShiftStrat_pred1)
# positive effect of signed shift on risk-taking (more risk-taking as shift increases, less risk-taking a shift decreases)
# positive effect of strategy (more risk-taking in strategy condition)
# positive interaction 
    # how does the weight change across conditions and shift sizes:
    # strategy + large positive shift: .33*.83 + 1*.05 + .33*1*.6 = .52
    # strategy + large negative shift: -.33*.83 + 1*.05 + -.33*1*.6 = -.42
    # natural + large positive shift: .33*.83 + -1*.05 + .33*-1*.6 = .023
    # natural + large negative shift: -.33*.83 + -1*.05 + -.33*-1*.6 = -.13
    # effect of shift (in both directions) is stronger in strategy condition

model_signedShiftStrat_pred3 = glm(choice ~ 0 + signedShiftsc*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_signedShiftStrat_pred3)

# AIC lower than model above
# positive effct of signed shift (more risk-taking as shift increases)
# positive interaction between shift and strategy, similar as above
# no effect of shift in this model (because we already accounted for it in trial-level?)

#POSITIVE AND NEGATIVE SHIFT
model_posNegShift_pred1 = glm(choice ~ 0 + posShiftsc  + negShiftsc, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_posNegShift_pred1) 
# only positive effect of negative shift

model_posNegShift_pred3 = glm(choice ~ 0 + posShiftsc  + negShiftsc, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_posNegShift_pred3) 
# similar results as above, just positive effect of negative shift (which ends up being less risk-taking with larger negative shifts)
# AIC smaller in this model


# POSITIVE AND NEGATIVE SHIFT WITH STRATEGY

model_posNegShiftStrat_pred1 = glm(choice ~ 0 + posShiftsc*strategyRecode + negShiftsc*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_posNegShiftStrat_pred1) 
# more risk-taking in strategy condition
# less risk-taking as negative shift increases (no interaction between negative shift and strategy)
# no main effect of positive shift but there is an interaction between positive shift and strategy
    # act natural, large positive shift = -1*.03 + .33*.5 + -1*.33*1.03 = -.205
    # strategy, large positive shift = 1*.03 + .33*.5 + 1*.33*1.03 = .53
    # weight of positive shift on risk-taking is negative in natural condition
    # weight of positive shift on risk-taking is positive in strategy condition

model_posNegShiftStrat_pred3 = glm(choice ~ 0 + posShiftsc*strategyRecode + negShiftsc*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_posNegShiftStrat_pred3)

# similar results above but with no main effect of strategy 
# similar negative effect of negative shift (beta is positive but neg shfit values are negative)
# and similar interaction bewteen positive shift and strategy
# AIC smaller here



# EARNINGS X EXPECTATIONS (I.E. TRIAL NORMALIZED)

model_earnsExp_pred1 = glm(choice ~ 0 + earnNormalizedOverall + trialSC, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_earnsExp_pred1)
# betas are in direction as expected, not significant though

model_earnsExp_pred3 = glm(choice ~ 0 + earnNormalizedOverall + trialSC, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_earnsExp_pred3)
# similar results above
# AIC smaller here

# EARNINGS AND EXPECTATIONS (TIME) INTERACTING
model_earnsExpIntxn_pred1 = glm(choice ~ 0 + earnNormalizedOverall*trialSC, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_earnsExpIntxn_pred1)
# trending interaction between earnings and expectations (time)

model_earnsExpIntxn_pred3 = glm(choice ~ 0 + earnNormalizedOverall*trialSC, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_earnsExpIntxn_pred3)
# same as model above
# aic smaller here


#EARNINGS, EXPECTATIONS AND STRATEGY
model_earnsExpIntxn_pred1 = glm(choice ~ 0 + earnNormalizedOverall*trialSC*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_earnsExpIntxn_pred1)
# only a trending p = .08 interaction between earnings and trial (expectations)


model_earnsExpIntxn_pred3 = glm(choice ~ 0 + earnNormalizedOverall*trialSC*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_earnsExpIntxn_pred3)
# similar results as above


# EARNINGS AND OUTCOME INTERACTION

model_earnsOcExpIntxn_pred1 = glm(choice ~ 0 + earnNormalizedOverall*pastOC1sc*trialSC*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_earnsOcExpIntxn_pred1)
# negative effect of past outcome
# positive interaction bewteen earnings and outcome
# AIC = 17880

# model above but remove interaction that includes trial
model_earnsOcIntxn_pred1 = glm(choice ~ 0 + earnNormalizedOverall*pastOC1sc*strategyRecode + trialSC, data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_earnsOcIntxn_pred1)
# negative effect of past outcome
# positive interaction bewteen earnings and outcome
# AIC = 17872 - this is lower than above when including trial in interaction

model_earnsOcIntxn_pred3 = glm(choice ~ 0 + earnNormalizedOverall*pastOC1sc*strategyRecode + trialSC, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_earnsOcIntxn_pred3)
# negative effect of past outcome
# positive interaction bewteen earnings and outcome
# AIC = 17855- lower than pred 3 model
# results are similar but now a trending (negative?) effect of strategy


# PUT ALL TIMESCALES IN MODEL

model_3timescales_pred1 = glm(choice ~ 0 + pastOC1sc*earnNormalizedOverall + posShiftsc + negShiftsc + trialSC,  data=rdmDFclean, family="binomial", offset=predModel1)
summary(model_3timescales_pred1)
# negative past outcome effect
# effect of negative shift only
# interaction between past outcome and earnings 


model_3timescales_pred3 = glm(choice ~ 0 + pastOC1sc*earnNormalizedOverall + posShiftsc + negShiftsc + trialSC,  data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_3timescales_pred3)
# similar as model above
# negative past outcome effect
# effect of negative shift only
# interaction between past outcome and earnings 
# smaller AIC here


model_3timescalesStrategy_pred1 = glm(choice ~ 0 + pastOC1sc*earnNormalizedOverall*strategyRecode + posShiftsc*strategyRecode + negShiftsc*strategyRecode + trialSC*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel1)
# similar main effects as above include negative past outcome, negative shift effect, pocxearnings
# strategy only effects positive shift
summary(model_3timescalesStrategy_pred1)

model_3timescalesStrategy_pred3 = glm(choice ~ 0 + pastOC1sc*earnNormalizedOverall*strategyRecode + posShiftsc*strategyRecode + negShiftsc*strategyRecode + trialSC*strategyRecode, data=rdmDFclean, family="binomial", offset=predModel3)
summary(model_3timescalesStrategy_pred3)

# similar main effects as above include negative past outcome, negative shift effect, pocxearnings
# this models hows additional negative effect of strategy
# similar positive interation between shift and strategy as above
# AIC is similar


```


```{r, subset-round1-data}

rdmRound1df = rdmDFclean[rdmDFclean$roundRDM==1,]

natRound1 = rcsSubLevelWide_clean[rcsSubLevelWide_clean$round1_strategy==0,]
stratRound1 = rcsSubLevelWide_clean[rcsSubLevelWide_clean$round1_strategy==1,]


# more risk-taking in strategy condition
mean(natRound1$round1_pgamble)
mean(stratRound1$round1_pgamble)

# slightly slower in strategy 
mean(natRound1$round1_RT)
mean(stratRound1$round1_RT)

# more difficult in strategy
mean(natRound1$round1_instDifficult)
mean(stratRound1$round1_instDifficult)

# instruction frequency higher in strategy
mean(natRound1$round1_instHowOften)
mean(stratRound1$round1_instHowOften)


colnames(rdmDFclean)


model_round1_triLevelStrat = glmer(choice ~ 1 + gainScaled + safeScaled + evLevScaled + strategyRecode + (1|subID), data=rdmRound1df , family = "binomial")
summary(model_round1_triLevelStrat)
# gain, safe and ev as expected
# no effect of strategy

rdmRound1df$predRnd1TriLev= predict(model_round1_triLevelStrat,type="link"); 

model_round1_3timescales = glm(choice ~ 0 + pastOC1sc*earnNormalizedOverall*strategyRecode + posShiftsc*strategyRecode + negShiftsc*strategyRecode + trialSC*strategyRecode, data=rdmRound1df, family="binomial", offset=predRnd1TriLev)
summary(model_round1_3timescales)
# similar results above even when just looking at round 1 data
  # negative past outcome, negative shift effect, interaction between strategy and positive shift
  # trending positive effect of earnings

```

